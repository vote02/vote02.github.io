<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§ä¼—æŠ•ç¥¨å¹³å°</title>
    <!-- Pi Network SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
/* é€šç”¨æ ·å¼ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 50%, #C084FC 100%);
    min-height: 100vh;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
    background: rgba(139, 92, 246, 0.35);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.5);
}

.header h1 {
    text-align: center;
    color: white;
    margin-bottom: 10px;
    font-size: 2.5em;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.header .subtitle {
    text-align: center;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 20px;
    font-size: 1.1em;
    font-weight: 400;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.user-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #8B5CF6;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.2em;
}

.user-details h3 {
    color: white;
    margin-bottom: 5px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.user-details p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.points-info {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #A855F7;
    padding: 10px 20px;
    border-radius: 25px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.points-info:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.points-icon {
    font-size: 1.2em;
}

.user-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* å¡ç‰‡æ ·å¼ */
.card {
    background: rgba(139, 92, 246, 0.35);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.5);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: #8B5CF6;
}

.card h2 {
    color: white;
    margin-bottom: 20px;
    font-size: 1.8em;
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.card-toggle {
    cursor: pointer;
    font-size: 1.2em;
    color: white;
    transition: transform 0.3s ease;
    user-select: none;
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.card.expanded .card-toggle {
    transform: translateY(-50%) rotate(180deg);
}

.card-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.card-content.collapsed {
    max-height: 0;
    opacity: 0;
    padding: 0;
    margin: 0;
}

/* è¡¨å•æ ·å¼ */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: white;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.8);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #8B5CF6;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    background: rgba(255, 255, 255, 1);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 120px;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.btn:active {
    transform: translateY(0);
}

.btn-primary {
    background: #8B5CF6;
    color: white;
}

.btn-secondary {
    background: linear-gradient(135deg, #f093fb, #f5576c);
    color: white;
}

.btn-success {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    color: white;
}

.btn-danger {
    background: linear-gradient(135deg, #fa709a, #fee140);
    color: white;
}

.btn-outline {
    background: rgba(139, 92, 246, 0.1);
    border: 2px solid #8B5CF6;
    color: white;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.btn-outline:hover {
    background: #8B5CF6;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn:disabled:hover {
    transform: none;
    box-shadow: none;
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease;
}

.modal-content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    margin: 5% auto;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: slideIn 0.3s ease;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease;
}

.close:hover {
    color: #8B5CF6;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* é¡¹ç›®å¡ç‰‡æ ·å¼ */
.project-card {
    background: rgba(139, 92, 246, 0.35);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.5);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.project-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.project-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: #8B5CF6;
}

.project-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.project-title {
    font-size: 1.3em;
    font-weight: 700;
    color: #4a5568;
    margin: 0;
    flex: 1;
    min-width: 200px;
}

.project-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-active {
    background: linear-gradient(135deg, #48bb78, #38a169);
    color: white;
}

.status-ended {
    background: linear-gradient(135deg, #ed8936, #dd6b20);
    color: white;
}

.status-published {
    background: #8B5CF6;
    color: white;
}

.project-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.info-item {
    text-align: center;
    padding: 10px;
    background: rgba(139, 92, 246, 0.1);
    border-radius: 12px;
}

.info-label {
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.info-value {
    font-size: 1.1em;
    font-weight: 700;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.project-description {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 15px;
    line-height: 1.6;
    padding: 15px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    border-left: 4px solid #8B5CF6;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.project-options {
    margin-bottom: 20px;
}

.project-options h4 {
    color: white;
    margin-bottom: 10px;
    font-size: 1.1em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.option-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 10px;
    border: 1px solid rgba(139, 92, 246, 0.2);
    transition: all 0.3s ease;
}

.option-item:hover {
    background: rgba(139, 92, 246, 0.1);
    border-color: #8B5CF6;
}

.option-text {
    font-weight: 600;
    color: #4a5568;
}

.option-stats {
    display: flex;
    gap: 15px;
    font-size: 0.9em;
    color: #718096;
}

.project-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.project-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(139, 92, 246, 0.2);
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.8);
    flex-wrap: wrap;
    gap: 10px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.project-creator {
    font-weight: 600;
}

.project-deadline {
    color: #e53e3e;
    font-weight: 600;
}

/* æŠ•ç¥¨ä¿¡æ¯æ ·å¼ */
.vote-info {
    background: linear-gradient(135deg, #e6fffa, #b2f5ea);
    border: 2px solid #4fd1c7;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
}

.vote-info h4 {
    color: #234e52;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.vote-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
    font-size: 0.9em;
}

.vote-detail {
    text-align: center;
    padding: 8px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 8px;
}

.vote-detail-label {
    color: #4a5568;
    font-size: 0.8em;
    margin-bottom: 3px;
}

.vote-detail-value {
    font-weight: 700;
    color: #234e52;
}

/* ç»Ÿè®¡å¾½ç« æ ·å¼ */
.stats-badges {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.stat-badge {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 12px 20px;
    border-radius: 25px;
    text-align: center;
    min-width: 120px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
}

.stat-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.stat-number {
    font-size: 1.5em;
    font-weight: 700;
    display: block;
}

.stat-label {
    font-size: 0.8em;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ç©ºçŠ¶æ€æ ·å¼ */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.empty-state-icon {
    font-size: 3em;
    margin-bottom: 15px;
    opacity: 0.7;
}

.empty-state h3 {
    margin-bottom: 10px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.empty-state p {
    font-size: 0.9em;
    line-height: 1.6;
}

/* åŠ è½½åŠ¨ç”» */
.loading {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #e2e8f0;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* è‡ªå®šä¹‰è­¦å‘Šæ¡†æ ·å¼ */
.custom-alert {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.custom-alert-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.8);
    transition: transform 0.3s ease;
}

.custom-alert.show {
    opacity: 1;
}

.custom-alert.show .custom-alert-content {
    transform: scale(1);
}

.custom-alert-icon {
    font-size: 3em;
    margin-bottom: 15px;
}

.custom-alert-message {
    font-size: 1.1em;
    color: #4a5568;
    margin-bottom: 20px;
    line-height: 1.6;
}

.custom-alert-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

/* è‡ªå®šä¹‰ç¡®è®¤æ¡†æ ·å¼ */
.custom-confirm {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.custom-confirm-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 450px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.8);
    transition: transform 0.3s ease;
}

.custom-confirm.show {
    opacity: 1;
}

.custom-confirm.show .custom-confirm-content {
    transform: scale(1);
}

/* è‡ªå®šä¹‰è¾“å…¥æ¡†æ ·å¼ */
.custom-prompt {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.custom-prompt-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 450px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.8);
    transition: transform 0.3s ease;
}

.custom-prompt.show {
    opacity: 1;
}

.custom-prompt.show .custom-prompt-content {
    transform: scale(1);
}

.custom-prompt-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    margin: 15px 0;
    transition: border-color 0.3s ease;
}

.custom-prompt-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ç§¯åˆ†æ˜ç»†æ¨¡æ€æ¡†æ ·å¼ */
.points-detail-modal {
    z-index: 9999;
}

.points-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
    padding: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 15px;
    color: white;
}

.summary-item {
    text-align: center;
}

.summary-label {
    font-size: 0.8em;
    opacity: 0.9;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.summary-value {
    font-size: 1.3em;
    font-weight: 700;
}

.points-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e2e8f0;
}

.points-detail-list {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
}

.detail-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 15px;
    padding: 15px;
    margin-bottom: 10px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
}

.detail-item:hover {
    background: rgba(102, 126, 234, 0.1);
    transform: translateX(5px);
}

.detail-time {
    font-size: 0.8em;
    color: #718096;
    white-space: nowrap;
}

.detail-type {
    font-weight: 600;
    color: #4a5568;
}

.detail-change {
    font-weight: 700;
    text-align: right;
    white-space: nowrap;
}

.detail-change.positive {
    color: #48bb78;
}

.detail-change.negative {
    color: #e53e3e;
}

.detail-description {
    grid-column: 1 / -1;
    font-size: 0.9em;
    color: #718096;
    margin-top: 5px;
    padding-top: 10px;
    border-top: 1px solid rgba(102, 126, 234, 0.1);
}

.empty-detail {
    text-align: center;
    padding: 40px 20px;
    color: #718096;
    font-style: italic;
}

/* é¡¹ç›®å¡ç‰‡å±•å¼€/æŠ˜å çŠ¶æ€ */
.project-card.expanded {
    background: rgba(255, 255, 255, 0.98);
}

.project-card.collapsed .project-description,
.project-card.collapsed .project-options,
.project-card.collapsed .vote-info {
    display: none;
}

/* ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .header {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .header h1 {
        font-size: 2em;
        margin-bottom: 15px;
    }
    
    .user-section {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    .user-info {
        justify-content: center;
    }
    
    .user-actions {
        justify-content: center;
    }
    
    .points-info {
        justify-content: center;
        padding: 12px 20px;
    }
    
    .card {
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .card h2 {
        font-size: 1.5em;
        margin-bottom: 15px;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
        font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
    }
    
    .btn {
        padding: 14px 20px;
        font-size: 16px;
        min-width: 100px;
    }
    
    .modal-content {
        margin: 10% auto;
        padding: 20px;
        width: 95%;
        max-height: 85vh;
    }
    
    .project-card {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .project-header {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    
    .project-title {
        font-size: 1.2em;
        min-width: auto;
    }
    
    .project-info {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
    }
    
    .info-item {
        padding: 8px;
    }
    
    .project-actions {
        flex-direction: column;
    }
    
    .project-meta {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        text-align: center;
    }
    
    .stats-badges {
        flex-direction: column;
        align-items: center;
    }
    
    .stat-badge {
        min-width: 200px;
    }
    
    .vote-details {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    }
    
    .option-item {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        text-align: center;
    }
    
    .option-stats {
        justify-content: center;
    }
    
    .custom-alert-content,
    .custom-confirm-content,
    .custom-prompt-content {
        width: 95%;
        padding: 25px;
    }
    
    .custom-alert-buttons {
        flex-direction: column;
    }
    
    .points-summary {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 10px;
        padding: 15px;
    }
    
    .detail-item {
        grid-template-columns: 1fr;
        gap: 8px;
        text-align: center;
    }
    
    .detail-change {
        text-align: center;
    }
    
    .detail-description {
        grid-column: 1;
        text-align: left;
    }
    
    .points-detail-list {
        max-height: 300px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 5px;
    }
    
    .header {
        padding: 10px;
    }
    
    .header h1 {
        font-size: 1.8em;
    }
    
    .card {
        padding: 15px;
    }
    
    .modal-content {
        margin: 5% auto;
        padding: 15px;
        width: 98%;
        max-height: 90vh;
    }
    
    .project-card {
        padding: 12px;
    }
    
    .btn {
        padding: 12px 16px;
        font-size: 14px;
        min-width: 80px;
    }
    
    .points-info {
        padding: 10px 16px;
        font-size: 0.9em;
    }
    
    .stat-badge {
        min-width: 150px;
        padding: 10px 16px;
    }
}

/* æŒ‰é’®æ ·å¼è¡¥å…… */
.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
}

.btn-secondary {
    background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
    color: white;
    border: none;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #d69e2e 0%, #c05621 100%);
}

.btn-danger {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    color: white;
    border: none;
}

.btn-danger:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
}

.btn-success {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    border: none;
}

.btn-success:hover {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
}

/* å·²å‘å¸ƒç»“æœæ ·å¼ */
.published-result {
    background: linear-gradient(135deg, #e6fffa, #b2f5ea);
    border: 2px solid #4fd1c7;
    border-radius: 12px;
    padding: 20px;
    margin-top: 15px;
}

.published-result h4 {
    color: #234e52;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.result-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 10px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 10px;
    border-left: 4px solid #4fd1c7;
}

.result-option.winner {
    background: linear-gradient(135deg, #fef5e7, #fed7aa);
    border-left-color: #f6ad55;
    font-weight: 700;
}

.result-stats {
    display: flex;
    gap: 20px;
    font-size: 0.9em;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* å‘å¸ƒè¡¨å•æ ·å¼ */
.publish-form {
    background: rgba(255, 255, 255, 0.95);
    padding: 25px;
    border-radius: 15px;
    border: 2px solid #e2e8f0;
}

.publish-warning {
    background: linear-gradient(135deg, #fed7d7, #feb2b2);
    border: 2px solid #fc8181;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    color: #742a2a;
}

.publish-warning h4 {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.option-selection {
    margin-bottom: 20px;
}

.option-selection h4 {
    color: white;
    margin-bottom: 15px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.option-radio {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 10px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.3s ease;
}

.option-radio:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
}

.option-radio input[type="radio"] {
    margin-right: 12px;
    transform: scale(1.2);
}

.option-radio.selected {
    background: rgba(102, 126, 234, 0.15);
    border-color: #667eea;
    font-weight: 600;
}

/* å­å¡ç‰‡æ ·å¼ */
.sub-section {
    margin-top: 20px;
}

.sub-card {
    background: rgba(255, 255, 255, 0.8);
    border-radius: 12px;
    margin-bottom: 15px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    overflow: hidden;
    transition: all 0.3s ease;
}

.sub-card:hover {
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
}

.sub-card-header {
    padding: 15px 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.sub-card-title {
    font-size: 1.1em;
    font-weight: 600;
    margin: 0;
}

.sub-card-toggle {
    font-size: 1.2em;
    transition: transform 0.3s ease;
    user-select: none;
}

.sub-card.expanded .sub-card-toggle {
    transform: rotate(180deg);
}

.sub-card-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.sub-card-content.collapsed {
    max-height: 0;
    opacity: 0;
    padding: 0;
}

.sub-card-content:not(.collapsed) {
    padding: 20px;
}

/* æˆ‘çš„é¡¹ç›®ç‰¹æ®Šé¢œè‰² */
.sub-card.created-projects .sub-card-header {
    background: linear-gradient(135deg, #48bb78, #38a169);
}

.sub-card.participated-projects .sub-card-header {
    background: linear-gradient(135deg, #ed8936, #dd6b20);
}

/* æ¨¡æ€æ¡†ç‰¹æ®Šæ ·å¼ */
.modal.points-detail-modal {
    z-index: 99999;
}

.modal.test-login-modal {
    z-index: 10001;
}

.modal.custom-alert {
    z-index: 10002;
}

.modal.custom-confirm {
    z-index: 10003;
}

.modal.custom-prompt {
    z-index: 10004;
}

/* æ¨¡æ€æ¡†åŠ¨ç”»å¢å¼º */
.modal.show {
    animation: modalFadeIn 0.3s ease;
}

.modal.show .modal-content {
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        backdrop-filter: blur(0px);
    }
    to {
        opacity: 1;
        backdrop-filter: blur(5px);
    }
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* å…³é—­æŒ‰é’®å¢å¼º */
.modal .close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 24px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.05);
}

.modal .close:hover {
    color: #667eea;
    background: rgba(102, 126, 234, 0.1);
    transform: scale(1.1);
}

/* æ¨¡æ€æ¡†å†…é€‰é¡¹æ ·å¼ */
.modal-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.modal-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
}

.modal-option:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
}

.option-progress {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
}

.option-progress-bar {
    height: 100%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 4px;
    transition: width 0.5s ease;
}

/* ç»“æœæ˜¾ç¤ºæ ·å¼ */
.result-display {
    background: linear-gradient(135deg, #f7fafc, #edf2f7);
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
    border: 2px solid #e2e8f0;
}

.result-display h3 {
    color: #4a5568;
    margin-bottom: 20px;
    text-align: center;
    font-size: 1.3em;
}

.result-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin-bottom: 12px;
    background: white;
    border-radius: 10px;
    border-left: 4px solid #e2e8f0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.result-option:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.result-option.winner {
    background: linear-gradient(135deg, #fef5e7, #fed7aa);
    border-left-color: #f6ad55;
    font-weight: 700;
    transform: scale(1.02);
}

.result-option.winner:hover {
    transform: scale(1.02) translateX(5px);
}

/* æµ‹è¯•ç™»å½•æ¨¡æ€æ¡†æ ·å¼ */
.test-login-modal .modal-content {
    max-width: 500px;
}

.user-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
    max-height: 300px;
    overflow-y: auto;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
}

.user-item:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
}

.user-item.current {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    font-weight: 600;
}

.user-info-test {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.user-name {
    font-weight: 600;
    margin-bottom: 2px;
}

.user-points {
    font-size: 0.9em;
    opacity: 0.8;
}

.test-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

/* è§„åˆ™å†…å®¹æ ·å¼ */
.rules-content {
    padding: 0;
}

.rule-section {
    margin-bottom: 25px;
    padding: 20px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
    border-left: 4px solid #667eea;
}

.rule-section h3 {
    color: white;
    margin-bottom: 15px;
    font-size: 1.2em;
    display: flex;
    align-items: center;
    gap: 8px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.rule-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.rule-list li {
    padding: 8px 0;
    padding-left: 20px;
    position: relative;
    line-height: 1.6;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.rule-list li::before {
    content: 'â€¢';
    color: #667eea;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 8px;
}

/* ç»Ÿè®¡å¾½ç« æ ·å¼ */
.stats-badge {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
    margin-left: 10px;
}

/* é¡¹ç›®ç»Ÿè®¡æ ·å¼ */
.project-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 20px;
    padding: 20px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
}

.stat-item {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 2em;
    font-weight: bold;
    color: #667eea;
    line-height: 1;
}

.stat-label {
    display: block;
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.8);
    margin-top: 5px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* é€‰é¡¹æ˜¾ç¤ºæ ·å¼ */
.options-display {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.option-item {
    flex: 1;
    padding: 12px;
    background: rgba(102, 126, 234, 0.1);
    border: 2px solid #667eea;
    border-radius: 8px;
    text-align: center;
    font-weight: 600;
    color: #667eea;
}

/* å¡ç‰‡å®¹å™¨æ ·å¼ */
.card-container {
    margin-bottom: 20px;
}

/* é¡¹ç›®ç½‘æ ¼æ ·å¼ */
.projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

/* å……å€¼/æç°è¡¨å•æ ·å¼ */
.recharge-form,
.withdraw-form {
    padding: 0;
}

.balance-display {
    background: rgba(102, 126, 234, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: center;
}

.exchange-rate {
    text-align: center;
    margin-bottom: 20px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.receive-address,
.transfer-info,
.withdraw-input {
    margin-bottom: 20px;
}

.address-container {
    display: flex;
    gap: 10px;
    margin: 10px 0;
}

.address-container input {
    flex: 1;
}

.btn-copy {
    background: #667eea;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.btn-copy:hover {
    background: #5a67d8;
}

.address-note {
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.8);
    margin-top: 5px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.transfer-input,
.withdraw-input {
    margin-bottom: 15px;
}

.transfer-amount-inline .inline-input-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.convert-info {
    font-size: 0.9em;
    color: #667eea;
    font-weight: 600;
}

.recharge-notice,
.withdraw-notice {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid #ffc107;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}

.notice-text {
    margin-bottom: 10px;
    color: #856404;
    font-weight: 600;
}

.notice-list {
    margin: 0;
    padding-left: 20px;
    color: #856404;
}

.notice-list li {
    margin-bottom: 5px;
}

.frozen-notice {
    font-size: 0.9em;
    color: #e53e3e;
    margin-top: 5px;
}

/* å“åº”å¼è®¾è®¡å¢å¼º */
@media (max-width: 768px) {
    .sub-card-header {
        padding: 12px 15px;
    }
    
    .sub-card-content:not(.collapsed) {
        padding: 15px;
    }
    
    .result-display {
        padding: 15px;
    }
    
    .modal-option {
        padding: 12px;
    }
    
    .user-item {
        padding: 10px 12px;
    }
    
    .test-actions {
        flex-direction: column;
    }
    
    .project-stats {
        gap: 20px;
    }
    
    .stat-number {
        font-size: 1.5em;
    }
    
    .projects-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .options-display {
        flex-direction: column;
    }
    
    .address-container {
        flex-direction: column;
    }
    
    .transfer-amount-inline .inline-input-group {
        flex-direction: column;
        align-items: stretch;
    }
}

@media (max-width: 480px) {
    .sub-card-header {
        padding: 10px 12px;
    }
    
    .sub-card-content:not(.collapsed) {
        padding: 12px;
    }
    
    .result-display {
        padding: 12px;
    }
    
    .result-option {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        text-align: center;
    }
    
    .result-stats {
        justify-content: center;
    }
    
    .rule-section {
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .project-stats {
        flex-direction: column;
        gap: 15px;
    }
}
    </style>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        window.Pi = window.Pi || {};
    </script>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ—³ï¸ å¤§ä¼—æŠ•ç¥¨å¹³å°</h1>
            <p class="subtitle">å‚ä¸æŠ•ç¥¨è·å–å¥–åŠ±</p>
            <div class="user-section">
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <h3 id="userName">æœªç™»å½•</h3>
                        <p id="userStats">ç§¯åˆ†: 0 | æŠ•ç¥¨: 0æ¬¡</p>
                    </div>
                    <div class="points-info" id="pointsBalance" title="ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†æ˜ç»†">
                        <span class="points-icon">ğŸ’°</span>
                        <span id="pointsValue">0</span>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="btn btn-success" id="rechargeBtn">å……å€¼</button>
                    <button class="btn btn-primary" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-secondary" id="logoutBtn" style="display: none;">é€€å‡º</button>
                    <button class="btn btn-outline" id="withdrawBtn">æç°</button>
                </div>
         </div>
     </div>

    <!-- è‡ªå®šä¹‰è­¦å‘Šæ¡† -->
    <div id="customAlert" class="custom-alert">
        <div class="custom-alert-content">
            <div class="custom-alert-icon">âš ï¸</div>
            <div class="custom-alert-message" id="customAlertMessage">è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯</div>
            <div class="custom-alert-buttons">
                <button class="btn btn-primary" id="customAlertOk">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤æ¡† -->
    <div id="customConfirm" class="custom-confirm">
        <div class="custom-confirm-content">
            <div class="custom-alert-icon">â“</div>
            <div class="custom-alert-message" id="customConfirmMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</div>
            <div class="custom-alert-buttons">
                <button class="btn btn-primary" id="customConfirmOk">ç¡®å®š</button>
                <button class="btn btn-outline" id="customConfirmCancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
    <div id="customPrompt" class="custom-prompt">
        <div class="custom-prompt-content">
            <div class="custom-alert-icon">ğŸ“</div>
            <div class="custom-alert-message" id="customPromptMessage">è¯·è¾“å…¥å†…å®¹:</div>
            <input type="text" class="custom-prompt-input" id="customPromptInput" placeholder="è¯·è¾“å…¥...">
            <div class="custom-alert-buttons">
                <button class="btn btn-primary" id="customPromptOk">ç¡®å®š</button>
                <button class="btn btn-outline" id="customPromptCancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç§¯åˆ†æ˜ç»†æ¨¡æ€æ¡† -->
    <div id="pointsDetailModal" class="modal points-detail-modal">
        <div class="modal-content">
            <span class="close" onclick="guessGame.closePointsDetailModal()">&times;</span>
            <h2>ğŸ’° ç§¯åˆ†æ˜ç»†</h2>
            
            <!-- ç§¯åˆ†æ±‡æ€» -->
            <div class="points-summary">
                <div class="summary-item">
                    <div class="summary-label">å½“å‰ä½™é¢</div>
                    <div class="summary-value" id="currentPointsDisplay">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æ€»æ”¶å…¥</div>
                    <div class="summary-value" id="totalIncomeDisplay">+0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æ€»æ”¯å‡º</div>
                    <div class="summary-value" id="totalExpenseDisplay">-0</div>
                </div>
            </div>
            
            <!-- æ˜ç»†åˆ—è¡¨ -->
            <div class="points-detail-header">
                <h3>äº¤æ˜“è®°å½•</h3>
            </div>
            <div class="points-detail-list" id="pointsDetailList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main>
            <!-- æ‰€æœ‰æŠ•ç¥¨é¡¹ç›®å¡ç‰‡ - ç½®é¡¶ -->
            <div class="card-container">
                <div class="card" id="projects-card">
                    <div class="card-header" onclick="toggleCard('projects-card')">
                        <h2>ğŸ† æ‰€æœ‰é¡¹ç›® <span id="allProjectsStats" class="stats-badge"></span></h2>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-content collapsed">
                        <div class="project-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="totalProjects">0</span>
                                <span class="stat-label">è¿›è¡Œä¸­</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="totalParticipants">0</span>
                                <span class="stat-label">æ€»å‚ä¸</span>
                            </div>
                        </div>
                        <div id="projectsList" class="projects-grid">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æˆ‘çš„æŠ•ç¥¨é¡¹ç›®å¡ç‰‡ -->
            <div class="card-container">
                <div class="card" id="my-projects-card">
                    <div class="card-header" onclick="toggleCard('my-projects-card')">
                        <h2>â• åˆ›å»ºé¡¹ç›®</h2>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-content collapsed">
                        <div class="create-tips">
                            <p class="tip-text">ğŸ’¡ <strong>åˆ›å»ºæç¤ºï¼š</strong>ä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºæŠ•ç¥¨é¡¹ç›®ï¼Œç³»ç»Ÿé»˜è®¤æä¾›"æ˜¯"å’Œ"å¦"ä¸¤ä¸ªé€‰é¡¹ã€‚<strong>å‘èµ·äººè¯·åŠ¡å¿…å…ˆæŸ¥çœ‹æ‰€æœ‰æ¸¸æˆè§„åˆ™ï¼</strong></p>
                        </div>
                        <form id="createProjectForm" class="create-form">
                            <div class="form-group">
                                <label for="projectTitle">é¡¹ç›®æ ‡é¢˜</label>
                                <input type="text" id="projectTitle" placeholder="è¾“å…¥æŠ•ç¥¨é¡¹ç›®æ ‡é¢˜" required>
                            </div>
                            <div class="form-group">
                                <label for="projectDescription">é¡¹ç›®æè¿°</label>
                                <textarea id="projectDescription" placeholder="è¯¦ç»†æè¿°æŠ•ç¥¨é¡¹ç›®" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="maxPoints">æœ€é«˜æŠ•ç¥¨ç§¯åˆ†è®¾ç½®</label>
                                <input type="number" id="maxPoints" placeholder="è®¾ç½®å•ä¸ªé€‰é¡¹æœ€é«˜å¯æŠ•ç¥¨ç§¯åˆ†" min="1" max="1000000" value="10000" required>
                                <small style="color: rgba(255, 255, 255, 0.8); text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);">å½“ä»»ä¸€é€‰é¡¹è¾¾åˆ°æ­¤ç§¯åˆ†ä¸Šé™æ—¶ï¼Œè¯¥é€‰é¡¹å°†åœæ­¢æ¥å—æ–°æŠ•ç¥¨</small>
                            </div>
                            <div class="form-group">
                                <label>æŠ•ç¥¨é€‰é¡¹ï¼ˆå›ºå®šï¼‰</label>
                                <div class="options-display">
                                    <div class="option-item">âœ“ æ˜¯</div>
                                    <div class="option-item">âœ— å¦</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="deadline">æˆªæ­¢æ—¶é—´</label>
                                <input type="datetime-local" id="deadline" required>
                            </div>
                            <button type="submit" class="btn btn-primary">åˆ›å»ºæŠ•ç¥¨é¡¹ç›®</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- æˆ‘çš„é¡¹ç›®å¡ç‰‡ -->
            <div class="card-container">
                <div class="card" id="my-projects-card">
                    <div class="card-header" onclick="toggleCard('my-projects-card')">
                        <h2>ğŸ“ æˆ‘çš„é¡¹ç›®</h2>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-content collapsed">
                        <!-- å­å¡ç‰‡åŒºåŸŸ -->
                        <div class="sub-section">
                            <!-- æˆ‘åˆ›å»ºçš„é¡¹ç›® -->
                            <div class="sub-card created-projects" id="created-projects-card">
                                <div class="sub-card-header" onclick="toggleSubCard('created-projects-card')">
                                    <h3 class="sub-card-title">æˆ‘åˆ›å»ºçš„é¡¹ç›® <span id="createdProjectsStats" class="stats-badge">0</span></h3>
                                    <span class="sub-card-toggle">â–¼</span>
                                </div>
                                <div class="sub-card-content collapsed">
                                    <div id="createdProjectsList" class="projects-grid">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">ğŸ“</div>
                                            <h3>æš‚æ— åˆ›å»ºçš„é¡¹ç›®</h3>
                                            <p>åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæŠ•ç¥¨é¡¹ç›®å§ï¼</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æˆ‘å‚ä¸çš„é¡¹ç›® -->
                            <div class="sub-card participated-projects" id="participated-projects-card">
                                <div class="sub-card-header" onclick="toggleSubCard('participated-projects-card')">
                                    <h3 class="sub-card-title">æˆ‘å‚ä¸çš„é¡¹ç›® <span id="participatedProjectsStats" class="stats-badge">0</span></h3>
                                    <span class="sub-card-toggle">â–¼</span>
                                </div>
                                <div class="sub-card-content collapsed">
                                    <div id="participatedProjectsList" class="projects-grid">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">ğŸ—³ï¸</div>
                                            <h3>æš‚æ— å‚ä¸çš„é¡¹ç›®</h3>
                                            <p>å‚ä¸æŠ•ç¥¨é¡¹ç›®ï¼Œèµ¢å–å¥–åŠ±ï¼</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¸¸æˆè§„åˆ™å¡ç‰‡ -->
            <div class="card-container">
                <div class="card" id="rules-card">
                    <div class="card-header" onclick="toggleCard('rules-card')">
                        <h2>ğŸ“‹ æ¸¸æˆè§„åˆ™</h2>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-content collapsed">
                        <div class="rules-content">
                            <div class="rule-section">
                                <h3>ğŸ¯ åŸºæœ¬è§„åˆ™</h3>
                                <ul class="rule-list">
                                    <li>ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„æŠ•ç¥¨é¡¹ç›®</li>
                                    <li>æ‰€åˆ›å»ºçš„é¡¹ç›®çš„æœ€ç»ˆç»“æœåªèƒ½é€‰æ‹©æ˜¯æˆ–å¦</li>
                                    <li>æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥å¤šæ¬¡æŠ•ç¥¨</li>
                                    <li>ç”¨æˆ·æŠ•ç¥¨åä¸å¯æ’¤é”€ï¼Œé¡¹ç›®å‘èµ·åï¼Œæ— äººå‚ä¸çš„çŠ¶æ€ä¸‹å‘èµ·äººå¯ä»¥åˆ é™¤ï¼Œåªè¦æœ‰äººå‚ä¸å°±ä¸èƒ½åˆ é™¤æ­¤é¡¹ç›®</li>
                                    <li>åªæœ‰é¡¹ç›®åˆ›å»ºè€…å¯ä»¥å…¬å¸ƒç»“æœ</li>
                                </ul>
                            </div>
                            
                            <div class="rule-section">
                                <h3>ğŸ’° ç§¯åˆ†è§„åˆ™</h3>
                                <ul class="rule-list">
                                    <li>åˆ›å»ºé¡¹ç›®æ—¶å¯ä»¥è®¾ç½®å•ä¸ªé€‰é¡¹çš„æœ€é«˜æŠ•ç¥¨ç§¯åˆ†ä¸Šé™ï¼Œå½“ä»»ä¸€é€‰é¡¹è¾¾åˆ°æ­¤ç§¯åˆ†ä¸Šé™æ—¶ï¼Œè¯¥é€‰é¡¹å°†åœæ­¢æ¥å—æ–°æŠ•ç¥¨ï¼Œç”¨æˆ·åªèƒ½æŠ•ç¥¨ç»™å¦ä¸€ä¸ªé€‰é¡¹</li>
                                    <li>åˆ›å»º10000åˆ†çš„é¡¹ç›®ï¼Œè´¦æˆ·å°±è¦æœ‰10000å¯ç”¨ç§¯åˆ†ï¼Œç§¯åˆ†ä¸è¶³è¯·å……å€¼</li>
                                    <li>ç‚¹å‡»åˆ›å»ºåç³»ç»Ÿè‡ªåŠ¨å†»ç»“å‘èµ·äººè´¦æˆ·çš„ç›¸åº”ç§¯åˆ†</li>
                                    <li>ç”¨æˆ·æŠ•ç¥¨åçš„ç§¯åˆ†è‡ªåŠ¨è½¬ç§»åˆ°æ­¤é¡¹ç›®å‘èµ·äººè´¦æˆ·ï¼Œé»˜è®¤ä¿æŒå†»ç»“çŠ¶æ€ï¼Œé¡¹ç›®æ­£å¸¸å®Œç»“åæ‰èƒ½è§£å†»</li>
                                    <li>æŠ•ç¥¨æ­£ç¡®çš„ç”¨æˆ·å°†è·å¾—åŒå€ç§¯åˆ†å¥–åŠ±</li>
                                    <li>é¡¹ç›®æ­£å¸¸å®Œç»“åï¼ŒæŠ•ç¥¨é”™è¯¯çš„ç”¨æˆ·å·²ç»è½¬ç§»åˆ°å‘èµ·äººè´¦æˆ·çš„ç§¯åˆ†å°†è‡ªåŠ¨è§£å†»ï¼ŒæŠ•ç¥¨æ­£ç¡®çš„ç”¨æˆ·æ‰€å¾—ç§¯åˆ†ç›´æ¥ä»é¡¹ç›®å‘èµ·äººè´¦æˆ·è‡ªåŠ¨åˆ’è½¬åˆ°å¯¹åº”çš„ç”¨æˆ·è´¦æˆ·</li>
                                </ul>
                            </div>
                            
                            <div class="rule-section">
                                <h3>â° æ—¶é—´è§„åˆ™</h3>
                                <ul class="rule-list">
                                    <li>é¡¹ç›®æˆªæ­¢æ—¶é—´åˆ°äº†ä»¥åè¯·åŠæ—¶å…¬å¸ƒæ­£ç¡®ç»“æœ</li>
                                    <li>è¶…æ—¶3å°æ—¶æœªå…¬å¸ƒç»“æœï¼Œç³»ç»Ÿç›´æ¥æŒ‰åŸè·¯é€€å›æ‰€æœ‰å‚ä¸è€…çš„ç§¯åˆ†ï¼Œæ‰£é™¤é¡¹ç›®å‘èµ·äººè¢«å†»ç»“çš„ç§¯åˆ†60%çš„æ¯”ä¾‹</li>
                                </ul>
                            </div>
                            
                            <div class="rule-section">
                                <h3>ğŸ” å®¡æ ¸è§„åˆ™</h3>
                                <ul class="rule-list">
                                    <li>å…¬å¸ƒç»“æœéœ€è¦æäº¤ç”³è¯·</li>
                                    <li>å†æ¬¡å…¬å¸ƒé”™è¯¯ç»“æœæŒ‰è¶…æ—¶å¤„ç†</li>
                                    <li>æ‰£é™¤å‘èµ·äººå†»ç»“ç§¯åˆ†çš„60%</li>
                                </ul>
                            </div>
                            
                            <div class="rule-section">
                                <h3>ğŸ’ å……å€¼æç°</h3>
                                <ul class="rule-list">
                                    <li>å…‘æ¢æ¯”ä¾‹ï¼š1 Pi = 1 ç§¯åˆ†</li>
                                    <li>å……å€¼éœ€è¦å‘å¹³å°åœ°å€è½¬è´¦Piå¸ï¼Œå¡«å†™è½¬è´¦ä¿¡æ¯åç­‰å¾…äººå·¥å®¡æ ¸</li>
                                    <li>ç”¨æˆ·æç°æ—¶ï¼Œåªå¯æç°æœªå†»ç»“çŠ¶æ€çš„ç§¯åˆ†ï¼Œå†»ç»“çŠ¶æ€çš„ç§¯åˆ†ä¸å¯æç°</li>
                                    <li>æç°éœ€è¦æä¾›æœ‰æ•ˆçš„Pié’±åŒ…åœ°å€ï¼Œç³»ç»Ÿå®¡æ ¸åå‘æ”¾</li>
                                    <li>æç°æ”¶å–10%æ‰‹ç»­è´¹</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- æŠ•ç¥¨æ¨¡æ€æ¡† -->
    <div id="voteModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modalTitle"></h3>
            <p id="modalDescription"></p>
            <div id="modalOptions" class="modal-options">
                <!-- é€‰é¡¹å°†åŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="vote-points-container">
                <label for="votePoints">æŠ•ç¥¨ç§¯åˆ†ï¼š</label>
                <input type="number" id="votePoints" min="1" value="10" placeholder="è¾“å…¥æŠ•ç¥¨ç§¯åˆ†">
                <span class="current-balance">å½“å‰ç§¯åˆ†: <span id="modalPointsBalance">0</span></span>
            </div>
            <div class="vote-warning">
                <p class="warning-text">âš ï¸ <strong>é‡è¦æé†’ï¼š</strong>ä¸€æ—¦æŠ•ç¥¨æäº¤å°†æ— æ³•æ’¤é”€ï¼Œåªèƒ½ç­‰å¾…é¡¹ç›®å‘èµ·äººå…¬å¸ƒç»“æœ</p>
            </div>
            <div class="vote-submit-container">
                <button id="submitVote" class="btn btn-primary">æäº¤æŠ•ç¥¨</button>
            </div>
        </div>
    </div>

    <!-- ç»“æœæ¨¡æ€æ¡† -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>æŠ•ç¥¨ç»“æœ</h3>
            <div id="resultContent">
                <!-- ç»“æœå°†åŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <!-- å……å€¼æ¨¡æ€æ¡† -->
    <div id="rechargeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ğŸ¥§ å……å€¼ç§¯åˆ†</h3>
            <div class="recharge-form">
                <div class="balance-display">
                    <p>å½“å‰ç§¯åˆ†ä½™é¢: <span id="rechargeModalPointsBalance">0</span> ç§¯åˆ†</p>
                </div>
                <div class="exchange-rate">
                    <p class="rate-info">å…‘æ¢æ¯”ä¾‹: 1 Pi = 1 ç§¯åˆ†</p>
                </div>
                
                <!-- æ”¶å¸åœ°å€æ˜¾ç¤º -->
                <div class="receive-address">
                    <label>å¹³å°æ”¶å¸åœ°å€ï¼š</label>
                    <div class="address-container">
                        <input type="text" id="platformAddress" readonly value="GA7QYNF7SOWQ3GLR2BGMZEHXAVIRZA4KVWLTJJFC7MGXUA74P7UJVSGZ">
                        <button id="copyAddress" class="btn btn-copy">å¤åˆ¶</button>
                    </div>
                    <p class="address-note">è¯·å¤åˆ¶æ­¤åœ°å€åˆ°æ‚¨çš„Pié’±åŒ…è¿›è¡Œè½¬è´¦</p>
                </div>
                
                <!-- è½¬è´¦ä¿¡æ¯å¡«å†™ -->
                <div class="transfer-info">
                    <div class="transfer-input transfer-amount-inline">
                        <div class="inline-input-group">
                            <label for="rechargePi">è½¬è´¦Piå¸æ•°é‡ï¼š</label>
                            <input type="number" id="rechargePi" min="0.01" step="0.01" placeholder="è¾“å…¥è½¬è´¦çš„Piå¸æ•°é‡">
                        </div>
                        <p class="convert-info">å°†è·å¾—ç§¯åˆ†: <span id="convertedPoints">0</span></p>
                    </div>
                    
                    <div class="transfer-input">
                        <label for="senderAddress">æ‚¨çš„é’±åŒ…åœ°å€ï¼š</label>
                        <input type="text" id="senderAddress" placeholder="è¾“å…¥æ‚¨çš„Pié’±åŒ…åœ°å€">
                    </div>
                    
                    <div class="transfer-input">
                        <label for="transactionHash">äº¤æ˜“å“ˆå¸Œï¼š</label>
                        <input type="text" id="transactionHash" placeholder="è¾“å…¥è½¬è´¦çš„äº¤æ˜“å“ˆå¸Œ">
                    </div>
                </div>
                
                <div class="recharge-notice">
                    <p class="notice-text">ğŸ“‹ <strong>å……å€¼æµç¨‹ï¼š</strong></p>
                    <ol class="notice-list">
                        <li>å¤åˆ¶ä¸Šæ–¹å¹³å°æ”¶å¸åœ°å€</li>
                        <li>åœ¨Pié’±åŒ…ä¸­å‘è¯¥åœ°å€è½¬è´¦</li>
                        <li>å¡«å†™è½¬è´¦é‡‘é¢ã€æ‚¨çš„é’±åŒ…åœ°å€å’Œäº¤æ˜“å“ˆå¸Œ</li>
                        <li>æäº¤å……å€¼ç”³è¯·ï¼Œç­‰å¾…äººå·¥å®¡æ ¸</li>
                    </ol>
                </div>
                
                <button id="submitRecharge" class="btn btn-primary">æäº¤å……å€¼ç”³è¯·</button>
            </div>
        </div>
    </div>

    <!-- æç°æ¨¡æ€æ¡† -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ğŸ’° æç°ç§¯åˆ†</h3>
            <div class="withdraw-form">
                <div class="balance-display">
                    <p>å¯æç°ç§¯åˆ†: <span id="withdrawModalPointsBalance">0</span> ç§¯åˆ†</p>
                    <p class="frozen-notice">å†»ç»“ç§¯åˆ†ä¸å¯æç°</p>
                </div>
                <div class="exchange-rate">
                    <p class="rate-info">å…‘æ¢æ¯”ä¾‹: 1 ç§¯åˆ† = 1 Piï¼ˆæ‰£é™¤10%æ‰‹ç»­è´¹ï¼‰</p>
                </div>
                
                <div class="withdraw-input">
                    <label for="withdrawPoints">æç°ç§¯åˆ†æ•°é‡ï¼š</label>
                    <input type="number" id="withdrawPoints" min="1" placeholder="è¾“å…¥è¦æç°çš„ç§¯åˆ†æ•°é‡">
                    <p class="convert-info">å®é™…åˆ°è´¦Piå¸: <span id="convertedPi">0</span></p>
                </div>
                
                <div class="withdraw-input">
                    <label for="withdrawAddress">æ‚¨çš„Pié’±åŒ…åœ°å€ï¼š</label>
                    <input type="text" id="withdrawAddress" placeholder="è¾“å…¥æ‚¨çš„Pié’±åŒ…åœ°å€">
                </div>
                
                <div class="withdraw-notice">
                    <p class="notice-text">ğŸ“‹ <strong>æç°è¯´æ˜ï¼š</strong></p>
                    <ul class="notice-list">
                        <li>æç°æ”¶å–10%æ‰‹ç»­è´¹</li>
                        <li>åªèƒ½æç°æœªå†»ç»“çš„ç§¯åˆ†</li>
                        <li>æç°ç”³è¯·éœ€è¦äººå·¥å®¡æ ¸</li>
                        <li>å®¡æ ¸é€šè¿‡åå°†è½¬è´¦åˆ°æ‚¨çš„Pié’±åŒ…</li>
                    </ul>
                </div>
                
                <button id="submitWithdraw" class="btn btn-primary">æäº¤æç°ç”³è¯·</button>
            </div>
        </div>
    </div>

    <!-- æµ‹è¯•ç™»å½•æ¨¡æ€æ¡† -->
    <div id="testLoginModal" class="modal test-login-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ğŸ§ª æµ‹è¯•ç™»å½•</h3>
            <p>é€‰æ‹©ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·è¿›è¡Œç™»å½•ï¼š</p>
            <div class="user-list" id="testUserList">
                <!-- æµ‹è¯•ç”¨æˆ·åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="test-actions">
                <button id="addTestUser" class="btn btn-secondary">æ·»åŠ æµ‹è¯•ç”¨æˆ·</button>
                <button id="clearTestData" class="btn btn-danger">æ¸…ç©ºæµ‹è¯•æ•°æ®</button>
            </div>
        </div>
    </div>

    <!-- å›ºå®šç™»å½•æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰ -->
    <div id="fixedLoginBtn" class="fixed-login-btn" style="display: none;">
        <button class="btn btn-primary" onclick="guessGame.login()">ğŸ” ç™»å½•</button>
    </div>

    <script>
        // Pi SDK åˆå§‹åŒ–
        Pi.init({ 
            version: "2.0", 
            sandbox: false // è®¾ç½®ä¸º false ä½¿ç”¨æ­£å¼ç¯å¢ƒï¼Œtrue ä½¿ç”¨æ²™ç›’ç¯å¢ƒ
        });
        
        // Pi App é…ç½®
        const PI_APP_CONFIG = {
            appId: '6f104bbc3618606c', // æ‚¨çš„ Pi App ID
            scopes: ['username', 'payments'], // è¯·æ±‚çš„æƒé™èŒƒå›´
            sandbox: false // æ˜¯å¦ä½¿ç”¨æ²™ç›’ç¯å¢ƒ
        };
        
        console.log('Pi SDK å·²åˆå§‹åŒ–ï¼ŒApp ID:', PI_APP_CONFIG.appId);
        
        // æŠ•ç¥¨æ¸¸æˆå¹³å°ç±»
        class GuessGamePlatform {
            constructor() {
                this.projects = [];
                this.votes = [];
                this.users = {};
                this.currentUser = null;
                this.selectedProjectId = null;
                this.selectedOption = null;
                this.pointsHistory = {}; // ç§¯åˆ†å†å²è®°å½•
                this.rechargeRequests = []; // å……å€¼è¯·æ±‚
                this.withdrawRequests = []; // æç°è¯·æ±‚
                this.pendingResults = []; // å¾…å‘å¸ƒç»“æœ
                
                // APIé…ç½®
                this.apiConfig = {
                    baseURL: this.detectEnvironment(),
                    endpoints: {
                        auth: '/api/auth',
                        projects: '/api/projects',
                        votes: '/api/votes',
                        users: '/api/users',
                        points: '/api/points'
                    }
                };
                
                console.log('APIé…ç½®:', this.apiConfig);
            }
            
            // æ£€æµ‹è¿è¡Œç¯å¢ƒ
            detectEnvironment() {
                const hostname = window.location.hostname;
                const port = window.location.port;
                
                if (hostname === 'localhost' || hostname === '127.0.0.1') {
                    return `http://${hostname}:3000`; // æœ¬åœ°å¼€å‘ç¯å¢ƒ
                } else if (hostname.includes('github.io')) {
                    return 'https://your-backend.herokuapp.com'; // GitHub Pages + Heroku
                } else if (hostname.includes('render.com')) {
                    return `https://${hostname}`; // Renderç¯å¢ƒ
                } else {
                    return ''; // ç›¸å¯¹è·¯å¾„ï¼Œé€‚ç”¨äºåŒåŸŸéƒ¨ç½²
                }
            }
            
            // åˆå§‹åŒ–
            async init() {
                console.log('åˆå§‹åŒ–æŠ•ç¥¨æ¸¸æˆå¹³å°...');
                
                // æ•°æ®è¿ç§»ï¼ˆç¡®ä¿å…¼å®¹æ€§ï¼‰
                this.migrateProjectData();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                this.checkLoginStatus();
                
                // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
                await this.renderProjects();
                
                // è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´
                this.setDefaultDeadline();
                
                console.log('æŠ•ç¥¨æ¸¸æˆå¹³å°åˆå§‹åŒ–å®Œæˆ');
            }
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // ç™»å½•/é€€å‡ºæŒ‰é’®
                document.getElementById('loginBtn').addEventListener('click', () => this.login());
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                
                // å……å€¼/æç°æŒ‰é’®
                document.getElementById('rechargeBtn').addEventListener('click', () => this.openRechargeModal());
                document.getElementById('withdrawBtn').addEventListener('click', () => this.openWithdrawModal());
                
                // åˆ›å»ºé¡¹ç›®è¡¨å•
                document.getElementById('createProjectForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createProject();
                });
                
                // æ·»åŠ é€‰é¡¹æŒ‰é’®
                document.getElementById('addOptionBtn').addEventListener('click', () => this.addOption());
                
                // å……å€¼ç›¸å…³
                document.getElementById('rechargePi').addEventListener('input', () => this.updateConvertedPoints());
                
                // æç°ç›¸å…³
                document.getElementById('withdrawPoints').addEventListener('input', () => this.updateConvertedPi());
                
                // ç§¯åˆ†ç‚¹å‡»äº‹ä»¶ï¼ˆå»¶è¿Ÿç»‘å®šï¼Œç¡®ä¿å…ƒç´ å­˜åœ¨ï¼‰
                setTimeout(() => {
                    this.bindPointsClickEvent();
                }, 100);
                
                // è‡ªå®šä¹‰è­¦å‘Šæ¡†æŒ‰é’®
                document.getElementById('customAlertOk').addEventListener('click', () => this.hideCustomAlert());
                
                // è‡ªå®šä¹‰ç¡®è®¤æ¡†æŒ‰é’®
                document.getElementById('customConfirmOk').addEventListener('click', () => this.hideCustomConfirm(true));
                document.getElementById('customConfirmCancel').addEventListener('click', () => this.hideCustomConfirm(false));
                
                // è‡ªå®šä¹‰è¾“å…¥æ¡†æŒ‰é’®
                document.getElementById('customPromptOk').addEventListener('click', () => {
                    const value = document.getElementById('customPromptInput').value.trim();
                    this.hideCustomPrompt(value || null);
                });
                document.getElementById('customPromptCancel').addEventListener('click', () => this.hideCustomPrompt(null));
            }
            
            // ç»‘å®šç§¯åˆ†ç‚¹å‡»äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
            bindPointsClickEvent() {
                const pointsBalance = document.getElementById('pointsBalance');
                if (pointsBalance) {
                    console.log('ç»‘å®šç§¯åˆ†ç‚¹å‡»äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆæœ¬ï¼‰');
                    
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé¿å…é‡å¤ç»‘å®šï¼‰
                    pointsBalance.removeEventListener('click', this.pointsClickHandler);
                    pointsBalance.removeEventListener('touchend', this.pointsTouchHandler);
                    
                    // PCç«¯ç‚¹å‡»äº‹ä»¶
                    this.pointsClickHandler = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ç§¯åˆ†ä½™é¢è¢«ç‚¹å‡»ï¼ˆPCç«¯ï¼‰');
                        this.openPointsDetailModal();
                    };
                    
                    // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
                    this.pointsTouchHandler = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ç§¯åˆ†ä½™é¢è¢«è§¦æ‘¸ï¼ˆç§»åŠ¨ç«¯ï¼‰');
                        this.openPointsDetailModal();
                    };
                    
                    pointsBalance.addEventListener('click', this.pointsClickHandler);
                    
                    // ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
                    if ('ontouchstart' in window) {
                        pointsBalance.addEventListener('touchend', this.pointsTouchHandler, { passive: false });
                        
                        // æ·»åŠ è§†è§‰åé¦ˆ
                        pointsBalance.style.cursor = 'pointer';
                        pointsBalance.style.userSelect = 'none';
                        pointsBalance.style.webkitUserSelect = 'none';
                        pointsBalance.style.webkitTouchCallout = 'none';
                        
                        // è§¦æ‘¸åé¦ˆ
                        pointsBalance.addEventListener('touchstart', (e) => {
                            pointsBalance.style.transform = 'scale(0.95)';
                        }, { passive: true });
                        
                        pointsBalance.addEventListener('touchcancel', (e) => {
                            pointsBalance.style.transform = 'scale(1)';
                        }, { passive: true });
                    }
                    
                    console.log('ç§¯åˆ†ç‚¹å‡»äº‹ä»¶ç»‘å®šå®Œæˆï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰');
                } else {
                    console.warn('ç§¯åˆ†ä½™é¢å…ƒç´ æœªæ‰¾åˆ°ï¼Œæ— æ³•ç»‘å®šç‚¹å‡»äº‹ä»¶');
                }
            }
            
            // ç»‘å®šæ¨¡æ€æ¡†å…³é—­äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
            bindModalCloseEvents() {
                const modal = document.getElementById('pointsDetailModal');
                if (!modal) return;
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­ç§¯åˆ†æ˜ç»†');
                        this.closePointsDetailModal();
                    }
                });
                
                // ESCé”®å…³é—­
                const escHandler = (e) => {
                    if (e.key === 'Escape' && modal.style.display === 'block') {
                        console.log('ESCé”®å…³é—­ç§¯åˆ†æ˜ç»†');
                        this.closePointsDetailModal();
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
             }
             
             // æ£€æŸ¥ç™»å½•çŠ¶æ€
             checkLoginStatus() {
                 const savedUser = localStorage.getItem('currentUser');
                 if (savedUser) {
                     this.currentUser = JSON.parse(savedUser);
                     this.updateUserDisplay();
                 }
             }
             
             // Pi SDKç™»å½•
             async login() {
                 console.log('å¼€å§‹Pi SDKç™»å½•æµç¨‹...');
                 console.log('ä½¿ç”¨App ID:', PI_APP_CONFIG.appId);
                 
                 try {
                     // æ£€æŸ¥Pi SDKæ˜¯å¦å¯ç”¨
                     if (typeof Pi === 'undefined') {
                         console.error('Pi SDKæœªåŠ è½½');
                         this.showCustomAlert('è¯·åœ¨Piæµè§ˆå™¨ä¸­æ‰“å¼€æ­¤åº”ç”¨');
                         return;
                     }
                     
                     console.log('Pi SDKçŠ¶æ€æ£€æŸ¥...');
                     
                     // æ£€æŸ¥Pi SDKæ˜¯å¦å·²åˆå§‹åŒ–
                     try {
                         // ä½¿ç”¨é…ç½®çš„å‚æ•°é‡æ–°åˆå§‹åŒ–ï¼ˆç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„é…ç½®ï¼‰
                         await Pi.init({ 
                             version: "2.0", 
                             sandbox: PI_APP_CONFIG.sandbox 
                         });
                         console.log('Pi SDKåˆå§‹åŒ–æˆåŠŸï¼Œç¯å¢ƒ:', PI_APP_CONFIG.sandbox ? 'æ²™ç›’' : 'æ­£å¼');
                     } catch (error) {
                         console.error('Pi SDKåˆå§‹åŒ–å¤±è´¥:', error);
                         throw new Error('Pi SDKåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                     }
                     
                     console.log('å¼€å§‹Piç”¨æˆ·è®¤è¯...');
                     console.log('è¯·æ±‚æƒé™èŒƒå›´:', PI_APP_CONFIG.scopes);
                     
                     // è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œä½¿ç”¨é…ç½®çš„æƒé™èŒƒå›´
                     const authResult = await Pi.authenticate(PI_APP_CONFIG.scopes, this.onIncompletePaymentFound.bind(this));
                     
                     console.log('Piè®¤è¯ç»“æœ:', authResult);
                     
                     if (authResult.accessToken) {
                         console.log('Piè®¤è¯æˆåŠŸï¼Œç»§ç»­åç«¯éªŒè¯...');
                         await this.continueLoginWithPi(authResult);
                     } else {
                         throw new Error('Piè®¤è¯å¤±è´¥ï¼šæœªè·å–åˆ°è®¿é—®ä»¤ç‰Œ');
                     }
                     
                 } catch (error) {
                     console.error('Piç™»å½•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                     
                     let errorMessage = 'ç™»å½•å¤±è´¥';
                     if (error.message.includes('SDK')) {
                         errorMessage = 'è¯·åœ¨Piæµè§ˆå™¨ä¸­æ‰“å¼€æ­¤åº”ç”¨';
                     } else if (error.message.includes('ç½‘ç»œ')) {
                         errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•';
                     } else if (error.message.includes('è®¤è¯')) {
                         errorMessage = 'Piè®¤è¯å¤±è´¥ï¼Œè¯·é‡è¯•';
                     } else {
                         errorMessage = `ç™»å½•å¤±è´¥: ${error.message}`;
                     }
                     
                     this.showCustomAlert(errorMessage);
                 }
             }
             
             // ç»§ç»­Piç™»å½•æµç¨‹ï¼ˆåç«¯éªŒè¯ï¼‰
             async continueLoginWithPi(authResult) {
                 try {
                     console.log('å¼€å§‹åç«¯APIéªŒè¯...');
                     
                     // æ„å»ºAPIè¯·æ±‚
                     const apiUrl = `${this.apiConfig.baseURL}${this.apiConfig.endpoints.auth}/pi-login`;
                     const requestData = {
                         accessToken: authResult.accessToken,
                         user: authResult.user,
                         appId: PI_APP_CONFIG.appId // æ·»åŠ App IDåˆ°è¯·æ±‚ä¸­
                     };
                     
                     console.log('å‘é€APIè¯·æ±‚åˆ°:', apiUrl);
                     console.log('è¯·æ±‚æ•°æ®:', requestData);
                     
                     // å‘é€åˆ°åç«¯éªŒè¯
                     const response = await fetch(apiUrl, {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                         },
                         body: JSON.stringify(requestData)
                     });
                     
                     console.log('APIå“åº”çŠ¶æ€:', response.status);
                     
                     if (!response.ok) {
                         const errorText = await response.text();
                         console.error('APIå“åº”é”™è¯¯:', errorText);
                         throw new Error(`åç«¯éªŒè¯å¤±è´¥: ${response.status} ${errorText}`);
                     }
                     
                     const result = await response.json();
                     console.log('åç«¯éªŒè¯æˆåŠŸ:', result);
                     
                     // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                     this.currentUser = {
                         uid: result.user.uid,
                         username: result.user.username,
                         points: result.user.points || 100, // æ–°ç”¨æˆ·é»˜è®¤100ç§¯åˆ†
                         accessToken: authResult.accessToken,
                         loginTime: new Date().toISOString()
                     };
                     
                     // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                     localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                     
                     // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
                     this.updateUserDisplay();
                     
                     // é‡æ–°æ¸²æŸ“é¡¹ç›®ï¼ˆæ˜¾ç¤ºç”¨æˆ·ç›¸å…³çš„æŠ•ç¥¨çŠ¶æ€ï¼‰
                     await this.renderProjects();
                     
                     console.log('Piç™»å½•æµç¨‹å®Œæˆ');
                     this.showCustomAlert(`æ¬¢è¿å›æ¥ï¼Œ${this.currentUser.username}ï¼`);
                     
                 } catch (error) {
                     console.error('åç«¯éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                     
                     // å¦‚æœæ˜¯ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿç™»å½•
                     if (error.message.includes('fetch') || error.message.includes('ç½‘ç»œ') || error.message.includes('Failed to fetch')) {
                         console.log('ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿç™»å½•');
                         await this.simulateLocalLogin(authResult);
                     } else {
                         throw error; // é‡æ–°æŠ›å‡ºå…¶ä»–ç±»å‹çš„é”™è¯¯
                     }
                 }
             }
             
             // æœ¬åœ°æ¨¡æ‹Ÿç™»å½•ï¼ˆç”¨äºå¼€å‘å’Œç½‘ç»œé—®é¢˜æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆï¼‰
             async simulateLocalLogin(authResult) {
                 console.log('æ‰§è¡Œæœ¬åœ°æ¨¡æ‹Ÿç™»å½•...');
                 
                 // ä»æœ¬åœ°å­˜å‚¨è·å–æˆ–åˆ›å»ºç”¨æˆ·æ•°æ®
                 const existingUsers = JSON.parse(localStorage.getItem('users') || '{}');
                 const uid = authResult.user.uid;
                 
                 if (existingUsers[uid]) {
                     // ç°æœ‰ç”¨æˆ·
                     this.currentUser = existingUsers[uid];
                     this.currentUser.accessToken = authResult.accessToken;
                     this.currentUser.loginTime = new Date().toISOString();
                 } else {
                     // æ–°ç”¨æˆ·
                     this.currentUser = {
                         uid: uid,
                         username: authResult.user.username,
                         points: 100, // æ–°ç”¨æˆ·é»˜è®¤100ç§¯åˆ†
                         accessToken: authResult.accessToken,
                         loginTime: new Date().toISOString()
                     };
                     
                     // ä¿å­˜æ–°ç”¨æˆ·åˆ°æœ¬åœ°ç”¨æˆ·åˆ—è¡¨
                     existingUsers[uid] = this.currentUser;
                     localStorage.setItem('users', JSON.stringify(existingUsers));
                 }
                 
                 // ä¿å­˜å½“å‰ç”¨æˆ·
                 localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                 
                 // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
                 this.updateUserDisplay();
                 
                 // é‡æ–°æ¸²æŸ“é¡¹ç›®
                 await this.renderProjects();
                 
                 console.log('æœ¬åœ°æ¨¡æ‹Ÿç™»å½•å®Œæˆ');
                 this.showCustomAlert(`æ¬¢è¿ï¼Œ${this.currentUser.username}ï¼ï¼ˆæœ¬åœ°æ¨¡å¼ï¼‰`);
             }
             
             // å¤„ç†æœªå®Œæˆçš„æ”¯ä»˜
             onIncompletePaymentFound(payment) {
                 console.log('å‘ç°æœªå®Œæˆçš„æ”¯ä»˜:', payment);
                 // è¿™é‡Œå¯ä»¥å¤„ç†æœªå®Œæˆçš„æ”¯ä»˜é€»è¾‘
                 // ä¾‹å¦‚ï¼šæ˜¾ç¤ºæ”¯ä»˜çŠ¶æ€ï¼Œå…è®¸ç”¨æˆ·å®Œæˆæ”¯ä»˜ç­‰
             }
             
             // é€€å‡ºç™»å½•
             logout() {
                 console.log('ç”¨æˆ·é€€å‡ºç™»å½•');
                 
                 this.currentUser = null;
                 localStorage.removeItem('currentUser');
                 
                 // æ›´æ–°UI
                 this.updateUserDisplay();
                 
                 // é‡æ–°æ¸²æŸ“é¡¹ç›®ï¼ˆéšè—ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼‰
                 this.renderProjects();
                 
                 this.showCustomAlert('å·²é€€å‡ºç™»å½•');
             }
             
             // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
             updateUserDisplay() {
                 const loginSection = document.getElementById('loginSection');
                 const userSection = document.getElementById('userSection');
                 const loginBtn = document.getElementById('loginBtn');
                 const logoutBtn = document.getElementById('logoutBtn');
                 const usernameSpan = document.getElementById('username');
                 const pointsBalance = document.getElementById('pointsBalance');
                 const rechargeBtn = document.getElementById('rechargeBtn');
                 const withdrawBtn = document.getElementById('withdrawBtn');
                 
                 if (this.currentUser) {
                     // å·²ç™»å½•çŠ¶æ€
                     loginSection.style.display = 'none';
                     userSection.style.display = 'block';
                     loginBtn.style.display = 'none';
                     logoutBtn.style.display = 'inline-block';
                     usernameSpan.textContent = this.currentUser.username;
                     pointsBalance.textContent = this.currentUser.points || 0;
                     
                     // é‡æ–°ç»‘å®šç§¯åˆ†ç‚¹å‡»äº‹ä»¶ï¼ˆç¡®ä¿ç”¨æˆ·ä¿¡æ¯æ›´æ–°åäº‹ä»¶æ­£å¸¸ï¼‰
                     setTimeout(() => {
                         this.bindPointsClickEvent();
                     }, 100);
                 } else {
                     // æœªç™»å½•çŠ¶æ€
                     loginSection.style.display = 'block';
                     userSection.style.display = 'none';
                     loginBtn.style.display = 'inline-block';
                     logoutBtn.style.display = 'none';
                 }
             }
             
             // éªŒè¯ç§¯åˆ†ä¸€è‡´æ€§
             validatePointsConsistency() {
                 if (!this.currentUser) return;
                 
                 const history = this.pointsHistory[this.currentUser.uid] || [];
                 let calculatedPoints = 100; // åˆå§‹ç§¯åˆ†
                 
                 history.forEach(record => {
                     if (record.type === 'recharge' || record.type === 'reward') {
                         calculatedPoints += record.amount;
                     } else if (record.type === 'withdraw' || record.type === 'vote' || record.type === 'penalty') {
                         calculatedPoints -= record.amount;
                     }
                 });
                 
                 if (Math.abs(calculatedPoints - this.currentUser.points) > 0.01) {
                     console.warn('ç§¯åˆ†ä¸ä¸€è‡´ï¼è®¡ç®—å€¼:', calculatedPoints, 'å½“å‰å€¼:', this.currentUser.points);
                     // å¯ä»¥é€‰æ‹©ä¿®æ­£æˆ–è®°å½•é”™è¯¯
                     this.currentUser.points = calculatedPoints;
                     this.updateUserDisplay();
                     localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                 }
             }
             
             // è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´ï¼ˆ24å°æ—¶åï¼‰
             setDefaultDeadline() {
                 const deadlineInput = document.getElementById('deadline');
                 if (deadlineInput) {
                     const tomorrow = new Date();
                     tomorrow.setDate(tomorrow.getDate() + 1);
                     deadlineInput.value = tomorrow.toISOString().slice(0, 16);
                 }
             }
             
             // æ‰“å¼€å……å€¼æ¨¡æ€æ¡†
             openRechargeModal() {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 document.getElementById('rechargeModal').style.display = 'block';
                 document.getElementById('rechargePi').value = '';
                 document.getElementById('convertedPoints').textContent = '0';
             }
             
             // æ›´æ–°è½¬æ¢åçš„ç§¯åˆ†æ˜¾ç¤º
             updateConvertedPoints() {
                 const piAmount = parseFloat(document.getElementById('rechargePi').value) || 0;
                 const points = piAmount * 100; // 1 Pi = 100 ç§¯åˆ†
                 document.getElementById('convertedPoints').textContent = points.toFixed(0);
             }
             
             // å¤åˆ¶å……å€¼åœ°å€
             copyRechargeAddress() {
                 const address = 'GB6YPGW5JFMMP2QB2USQ33EUWTXVL4ZT5ITUNCY3YKVWOJVMD3BWJBQH';
                 
                 if (navigator.clipboard && navigator.clipboard.writeText) {
                     navigator.clipboard.writeText(address).then(() => {
                         this.showCustomAlert('åœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                     }).catch(err => {
                         console.error('å¤åˆ¶å¤±è´¥:', err);
                         this.fallbackCopyText(address);
                     });
                 } else {
                     this.fallbackCopyText(address);
                 }
             }
             
             // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
             fallbackCopyText(text) {
                 const textArea = document.createElement('textarea');
                 textArea.value = text;
                 textArea.style.position = 'fixed';
                 textArea.style.left = '-999999px';
                 textArea.style.top = '-999999px';
                 document.body.appendChild(textArea);
                 textArea.focus();
                 textArea.select();
                 
                 try {
                     document.execCommand('copy');
                     this.showCustomAlert('åœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                 } catch (err) {
                     console.error('å¤åˆ¶å¤±è´¥:', err);
                     this.showCustomAlert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€');
                 } finally {
                     document.body.removeChild(textArea);
                 }
             }
             
             // æäº¤å……å€¼è¯·æ±‚
             async submitRecharge() {
                 const piAmount = parseFloat(document.getElementById('rechargePi').value);
                 
                 if (!piAmount || piAmount <= 0) {
                     this.showCustomAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„Piæ•°é‡');
                     return;
                 }
                 
                 if (piAmount < 0.1) {
                     this.showCustomAlert('æœ€å°å……å€¼é‡‘é¢ä¸º0.1 Pi');
                     return;
                 }
                 
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦å……å€¼ ${piAmount} Pi å—ï¼Ÿ\n\nè¯·ç¡®ä¿æ‚¨å·²ç»å‘æŒ‡å®šåœ°å€è½¬è´¦ç›¸åº”çš„Piå¸ã€‚`);
                 if (!confirmed) return;
                 
                 // åˆ›å»ºå……å€¼è¯·æ±‚
                 const rechargeRequest = {
                     id: Date.now().toString(),
                     userId: this.currentUser.uid,
                     username: this.currentUser.username,
                     piAmount: piAmount,
                     points: piAmount * 100,
                     status: 'pending',
                     createTime: new Date().toISOString(),
                     txHash: null // å®é™…åº”ç”¨ä¸­éœ€è¦ç”¨æˆ·æä¾›äº¤æ˜“å“ˆå¸Œ
                 };
                 
                 // ä¿å­˜å……å€¼è¯·æ±‚
                 this.rechargeRequests.push(rechargeRequest);
                 localStorage.setItem('rechargeRequests', JSON.stringify(this.rechargeRequests));
                 
                 // æ¨¡æ‹Ÿè‡ªåŠ¨å®Œæˆå……å€¼ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦ç®¡ç†å‘˜å®¡æ ¸ï¼‰
                 setTimeout(() => {
                     this.completeRecharge(rechargeRequest.id);
                 }, 2000);
                 
                 // å…³é—­æ¨¡æ€æ¡†
                 document.getElementById('rechargeModal').style.display = 'none';
                 
                 this.showCustomAlert('å……å€¼è¯·æ±‚å·²æäº¤ï¼Œè¯·ç­‰å¾…å¤„ç†...');
             }
             
             // å®Œæˆå……å€¼
             completeRecharge(requestId) {
                 const request = this.rechargeRequests.find(r => r.id === requestId);
                 if (!request || request.status !== 'pending') return;
                 
                 // æ›´æ–°ç”¨æˆ·ç§¯åˆ†
                 this.currentUser.points += request.points;
                 localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                 
                 // è®°å½•ç§¯åˆ†å†å²
                 this.addPointsRecord(this.currentUser.uid, {
                     type: 'recharge',
                     amount: request.points,
                     description: `å……å€¼ ${request.piAmount} Pi`,
                     relatedId: requestId
                 });
                 
                 // æ›´æ–°è¯·æ±‚çŠ¶æ€
                 request.status = 'completed';
                 request.completeTime = new Date().toISOString();
                 localStorage.setItem('rechargeRequests', JSON.stringify(this.rechargeRequests));
                 
                 // æ›´æ–°æ˜¾ç¤º
                 this.updateUserDisplay();
                 
                 this.showCustomAlert(`å……å€¼æˆåŠŸï¼è·å¾— ${request.points} ç§¯åˆ†`);
             }
             
             // æ‰“å¼€æç°æ¨¡æ€æ¡†
             openWithdrawModal() {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 document.getElementById('withdrawModal').style.display = 'block';
                 document.getElementById('withdrawPoints').value = '';
                 document.getElementById('convertedPi').textContent = '0';
                 document.getElementById('withdrawAddress').value = '';
             }
             
             // æ›´æ–°è½¬æ¢åçš„Piæ˜¾ç¤º
             updateConvertedPi() {
                 const points = parseFloat(document.getElementById('withdrawPoints').value) || 0;
                 const pi = points / 100; // 100 ç§¯åˆ† = 1 Pi
                 document.getElementById('convertedPi').textContent = pi.toFixed(2);
             }
             
             // éªŒè¯Piåœ°å€æ ¼å¼
             validatePiAddress(address) {
                 // ç®€å•çš„Piåœ°å€æ ¼å¼éªŒè¯ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦æ›´ä¸¥æ ¼çš„éªŒè¯ï¼‰
                 const piAddressRegex = /^G[A-Z0-9]{55}$/;
                 return piAddressRegex.test(address);
             }
             
             // æäº¤æç°è¯·æ±‚
             async submitWithdraw() {
                 const points = parseFloat(document.getElementById('withdrawPoints').value);
                 const address = document.getElementById('withdrawAddress').value.trim();
                 
                 if (!points || points <= 0) {
                     this.showCustomAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡');
                     return;
                 }
                 
                 if (points < 100) {
                     this.showCustomAlert('æœ€å°æç°é‡‘é¢ä¸º100ç§¯åˆ†');
                     return;
                 }
                 
                 if (!address) {
                     this.showCustomAlert('è¯·è¾“å…¥Pié’±åŒ…åœ°å€');
                     return;
                 }
                 
                 if (!this.validatePiAddress(address)) {
                     this.showCustomAlert('Pié’±åŒ…åœ°å€æ ¼å¼ä¸æ­£ç¡®');
                     return;
                 }
                 
                 if (points > this.currentUser.points) {
                     this.showCustomAlert('ç§¯åˆ†ä½™é¢ä¸è¶³');
                     return;
                 }
                 
                 const pi = points / 100;
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦æç° ${points} ç§¯åˆ†ï¼ˆ${pi} Piï¼‰å—ï¼Ÿ\n\næç°åœ°å€ï¼š${address}`);
                 if (!confirmed) return;
                 
                 // è®¡ç®—å†»ç»“ç§¯åˆ†ï¼ˆæç°æ‰‹ç»­è´¹ç­‰ï¼‰
                 const fee = Math.max(10, points * 0.02); // æœ€ä½10ç§¯åˆ†æ‰‹ç»­è´¹ï¼Œæˆ–2%
                 const totalDeduction = points + fee;
                 
                 if (totalDeduction > this.currentUser.points) {
                     this.showCustomAlert(`ç§¯åˆ†ä½™é¢ä¸è¶³ï¼ˆéœ€è¦ ${totalDeduction} ç§¯åˆ†ï¼ŒåŒ…å«æ‰‹ç»­è´¹ ${fee} ç§¯åˆ†ï¼‰`);
                     return;
                 }
                 
                 // åˆ›å»ºæç°è¯·æ±‚
                 const withdrawRequest = {
                     id: Date.now().toString(),
                     userId: this.currentUser.uid,
                     username: this.currentUser.username,
                     points: points,
                     piAmount: pi,
                     fee: fee,
                     address: address,
                     status: 'pending',
                     createTime: new Date().toISOString()
                 };
                 
                 // æ‰£é™¤ç§¯åˆ†ï¼ˆåŒ…å«æ‰‹ç»­è´¹ï¼‰
                 this.currentUser.points -= totalDeduction;
                 localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                 
                 // è®°å½•ç§¯åˆ†å†å²
                 this.addPointsRecord(this.currentUser.uid, {
                     type: 'withdraw',
                     amount: totalDeduction,
                     description: `æç° ${pi} Piï¼ˆå«æ‰‹ç»­è´¹ ${fee} ç§¯åˆ†ï¼‰`,
                     relatedId: withdrawRequest.id
                 });
                 
                 // ä¿å­˜æç°è¯·æ±‚
                 this.withdrawRequests.push(withdrawRequest);
                 localStorage.setItem('withdrawRequests', JSON.stringify(this.withdrawRequests));
                 
                 // å…³é—­æ¨¡æ€æ¡†
                 document.getElementById('withdrawModal').style.display = 'none';
                 
                 // æ›´æ–°æ˜¾ç¤º
                 this.updateUserDisplay();
                 
                 this.showCustomAlert('æç°è¯·æ±‚å·²æäº¤ï¼Œè¯·ç­‰å¾…å¤„ç†...');
             }
             
             // ç®¡ç†å‘˜åŠŸèƒ½ï¼šæ‰“å¼€æç°è¯·æ±‚ç®¡ç†
             openWithdrawRequests() {
                 // è¿™é‡Œå¯ä»¥å®ç°ç®¡ç†å‘˜æŸ¥çœ‹å’Œå¤„ç†æç°è¯·æ±‚çš„åŠŸèƒ½
                 console.log('æç°è¯·æ±‚:', this.withdrawRequests);
             }
             
             // ç®¡ç†å‘˜åŠŸèƒ½ï¼šå…³é—­æç°è¯·æ±‚ç®¡ç†
             closeWithdrawRequests() {
                 // å®ç°å…³é—­æç°è¯·æ±‚ç®¡ç†ç•Œé¢
             }
             
             // ç®¡ç†å‘˜åŠŸèƒ½ï¼šåŠ è½½æç°è¯·æ±‚
             loadWithdrawRequests() {
                 const requests = JSON.parse(localStorage.getItem('withdrawRequests') || '[]');
                 this.withdrawRequests = requests;
                 return requests;
             }
             
             // ç®¡ç†å‘˜åŠŸèƒ½ï¼šæ‰¹å‡†æç°
             approveWithdraw(requestId) {
                 const request = this.withdrawRequests.find(r => r.id === requestId);
                 if (!request || request.status !== 'pending') return;
                 
                 request.status = 'approved';
                 request.approveTime = new Date().toISOString();
                 localStorage.setItem('withdrawRequests', JSON.stringify(this.withdrawRequests));
                 
                 console.log('æç°è¯·æ±‚å·²æ‰¹å‡†:', request);
             }
             
             // ç®¡ç†å‘˜åŠŸèƒ½ï¼šæ‹’ç»æç°
             rejectWithdraw(requestId, reason) {
                 const request = this.withdrawRequests.find(r => r.id === requestId);
                 if (!request || request.status !== 'pending') return;
                 
                 // é€€è¿˜ç§¯åˆ†
                 const users = JSON.parse(localStorage.getItem('users') || '{}');
                 if (users[request.userId]) {
                     users[request.userId].points += (request.points + request.fee);
                     localStorage.setItem('users', JSON.stringify(users));
                     
                     // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œæ›´æ–°æ˜¾ç¤º
                     if (this.currentUser && this.currentUser.uid === request.userId) {
                         this.currentUser.points += (request.points + request.fee);
                         localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                         this.updateUserDisplay();
                     }
                 }
                 
                 request.status = 'rejected';
                 request.rejectTime = new Date().toISOString();
                 request.rejectReason = reason;
                 localStorage.setItem('withdrawRequests', JSON.stringify(this.withdrawRequests));
                 
                 console.log('æç°è¯·æ±‚å·²æ‹’ç»:', request);
             }
             
             // å¤„ç†è¶…æ—¶é¡¹ç›®
             handleTimeoutProjects() {
                 const now = new Date();
                 const timeoutProjects = this.projects.filter(project => {
                     const deadline = new Date(project.deadline);
                     return deadline < now && project.status === 'active' && !project.result;
                 });
                 
                 timeoutProjects.forEach(project => {
                     this.penalizeTimeoutProject(project);
                 });
             }
             
             // æƒ©ç½šè¶…æ—¶é¡¹ç›®
             penalizeTimeoutProject(project) {
                 console.log('å¤„ç†è¶…æ—¶é¡¹ç›®:', project.title);
                 
                 // æ ‡è®°é¡¹ç›®ä¸ºè¶…æ—¶
                 project.status = 'timeout';
                 project.timeoutTime = new Date().toISOString();
                 
                 // æƒ©ç½šåˆ›å»ºè€…ï¼ˆæ‰£é™¤ä¸€å®šç§¯åˆ†ï¼‰
                 const penalty = Math.min(50, project.totalVotes * 2); // æœ€å¤šæ‰£50ç§¯åˆ†
                 const users = JSON.parse(localStorage.getItem('users') || '{}');
                 
                 if (users[project.creatorId]) {
                     users[project.creatorId].points = Math.max(0, users[project.creatorId].points - penalty);
                     localStorage.setItem('users', JSON.stringify(users));
                     
                     // è®°å½•æƒ©ç½š
                     this.addPointsRecord(project.creatorId, {
                         type: 'penalty',
                         amount: penalty,
                         description: `é¡¹ç›®è¶…æ—¶æƒ©ç½šï¼š${project.title}`,
                         relatedId: project.id
                     });
                     
                     // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œæ›´æ–°æ˜¾ç¤º
                     if (this.currentUser && this.currentUser.uid === project.creatorId) {
                         this.currentUser.points = users[project.creatorId].points;
                         localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                         this.updateUserDisplay();
                     }
                 }
                 
                 // é€€è¿˜å‚ä¸è€…ç§¯åˆ†
                 const projectVotes = this.votes.filter(vote => vote.projectId === project.id);
                 projectVotes.forEach(vote => {
                     if (users[vote.userId]) {
                         users[vote.userId].points += vote.points;
                         
                         // è®°å½•é€€æ¬¾
                         this.addPointsRecord(vote.userId, {
                             type: 'refund',
                             amount: vote.points,
                             description: `é¡¹ç›®è¶…æ—¶é€€æ¬¾ï¼š${project.title}`,
                             relatedId: project.id
                         });
                         
                         // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œæ›´æ–°æ˜¾ç¤º
                         if (this.currentUser && this.currentUser.uid === vote.userId) {
                             this.currentUser.points = users[vote.userId].points;
                             localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                             this.updateUserDisplay();
                         }
                     }
                 });
                 
                 localStorage.setItem('users', JSON.stringify(users));
                 localStorage.setItem('projects', JSON.stringify(this.projects));
             }
             
             // åˆ é™¤é¡¹ç›®ï¼ˆåˆ›å»ºè€…ï¼‰
             async deleteProject(projectId) {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === projectId);
                 if (!project) {
                     this.showCustomAlert('é¡¹ç›®ä¸å­˜åœ¨');
                     return;
                 }
                 
                 if (project.creatorId !== this.currentUser.uid) {
                     this.showCustomAlert('åªèƒ½åˆ é™¤è‡ªå·±åˆ›å»ºçš„é¡¹ç›®');
                     return;
                 }
                 
                 // æ£€æŸ¥é¡¹ç›®çŠ¶æ€
                 if (project.status === 'active' && project.totalVotes > 0) {
                     this.showCustomAlert('æœ‰æŠ•ç¥¨çš„æ´»è·ƒé¡¹ç›®æ— æ³•åˆ é™¤');
                     return;
                 }
                 
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›®ã€Œ${project.title}ã€å—ï¼Ÿ`);
                 if (!confirmed) return;
                 
                 // åˆ é™¤é¡¹ç›®
                 this.projects = this.projects.filter(p => p.id !== projectId);
                 localStorage.setItem('projects', JSON.stringify(this.projects));
                 
                 // åˆ é™¤ç›¸å…³æŠ•ç¥¨
                 this.votes = this.votes.filter(v => v.projectId !== projectId);
                 localStorage.setItem('votes', JSON.stringify(this.votes));
                 
                 // å¦‚æœæœ‰å†»ç»“ç§¯åˆ†ï¼Œé‡Šæ”¾ç»™å‚ä¸è€…
                 const projectVotes = this.votes.filter(vote => vote.projectId === projectId);
                 if (projectVotes.length > 0) {
                     const users = JSON.parse(localStorage.getItem('users') || '{}');
                     projectVotes.forEach(vote => {
                         if (users[vote.userId]) {
                             users[vote.userId].points += vote.points;
                             
                             // è®°å½•é€€æ¬¾
                             this.addPointsRecord(vote.userId, {
                                 type: 'refund',
                                 amount: vote.points,
                                 description: `é¡¹ç›®åˆ é™¤é€€æ¬¾ï¼š${project.title}`,
                                 relatedId: projectId
                             });
                         }
                     });
                     localStorage.setItem('users', JSON.stringify(users));
                 }
                 
                 // é‡æ–°æ¸²æŸ“
                 await this.renderProjects();
                 
                 this.showCustomAlert('é¡¹ç›®å·²åˆ é™¤');
             }
             
             // åˆ é™¤å‚ä¸çš„é¡¹ç›®ï¼ˆæŠ•ç¥¨è®°å½•ï¼‰
             async deleteParticipatedProject(projectId) {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const userVotes = this.votes.filter(v => v.projectId === projectId && v.userId === this.currentUser.uid);
                 if (userVotes.length === 0) {
                     this.showCustomAlert('æ‚¨æ²¡æœ‰å‚ä¸æ­¤é¡¹ç›®');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === projectId);
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦åˆ é™¤åœ¨é¡¹ç›®ã€Œ${project?.title || 'æœªçŸ¥é¡¹ç›®'}ã€ä¸­çš„æŠ•ç¥¨è®°å½•å—ï¼Ÿ`);
                 if (!confirmed) return;
                 
                 // åˆ é™¤ç”¨æˆ·çš„æŠ•ç¥¨è®°å½•
                 this.votes = this.votes.filter(v => !(v.projectId === projectId && v.userId === this.currentUser.uid));
                 localStorage.setItem('votes', JSON.stringify(this.votes));
                 
                 // é‡æ–°æ¸²æŸ“
                 await this.renderProjects();
                 
                 this.showCustomAlert('æŠ•ç¥¨è®°å½•å·²åˆ é™¤');
             }
             
             // æ‰“å¼€å‘å¸ƒç»“æœè¯·æ±‚
             openPublishResultRequest(projectId) {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === projectId);
                 if (!project) {
                     this.showCustomAlert('é¡¹ç›®ä¸å­˜åœ¨');
                     return;
                 }
                 
                 if (project.creatorId !== this.currentUser.uid) {
                     this.showCustomAlert('åªèƒ½å‘å¸ƒè‡ªå·±åˆ›å»ºçš„é¡¹ç›®ç»“æœ');
                     return;
                 }
                 
                 if (project.result) {
                     this.showCustomAlert('é¡¹ç›®ç»“æœå·²å‘å¸ƒ');
                     return;
                 }
                 
                 // è®¾ç½®é€‰ä¸­çš„é¡¹ç›®
                 this.selectedProjectId = projectId;
                 
                 // æ˜¾ç¤ºå‘å¸ƒç»“æœæ¨¡æ€æ¡†
                 document.getElementById('publishResultModal').style.display = 'block';
                 
                 // æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                 const radioButtons = document.querySelectorAll('input[name="correctOption"]');
                 radioButtons.forEach(radio => radio.checked = false);
                 
                 // åŠ¨æ€ç”Ÿæˆé€‰é¡¹
                 const optionsContainer = document.getElementById('resultOptions');
                 optionsContainer.innerHTML = '';
                 
                 project.options.forEach((option, index) => {
                     const optionDiv = document.createElement('div');
                     optionDiv.className = 'option-item';
                     optionDiv.innerHTML = `
                         <input type="radio" id="option${index}" name="correctOption" value="${index}">
                         <label for="option${index}">${option}</label>
                     `;
                     optionsContainer.appendChild(optionDiv);
                 });
             }
             
             // æäº¤å‘å¸ƒç»“æœè¯·æ±‚
             async submitPublishResult() {
                 const selectedOption = document.querySelector('input[name="correctOption"]:checked');
                 
                 if (!selectedOption) {
                     this.showCustomAlert('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ');
                     return;
                 }
                 
                 const correctOptionIndex = parseInt(selectedOption.value);
                 const project = this.projects.find(p => p.id === this.selectedProjectId);
                 
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦å‘å¸ƒé¡¹ç›®ã€Œ${project.title}ã€çš„ç»“æœå—ï¼Ÿ\n\næ­£ç¡®ç­”æ¡ˆï¼š${project.options[correctOptionIndex]}`);
                 if (!confirmed) return;
                 
                 // åˆ›å»ºå‘å¸ƒç»“æœè¯·æ±‚
                 const publishRequest = {
                     id: Date.now().toString(),
                     projectId: this.selectedProjectId,
                     projectTitle: project.title,
                     creatorId: this.currentUser.uid,
                     correctOption: correctOptionIndex,
                     status: 'pending',
                     createTime: new Date().toISOString()
                 };
                 
                 // ä¿å­˜å‘å¸ƒè¯·æ±‚
                 this.pendingResults.push(publishRequest);
                 localStorage.setItem('pendingResults', JSON.stringify(this.pendingResults));
                 
                 // æ¨¡æ‹Ÿè‡ªåŠ¨å¤„ç†ï¼ˆå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦ç®¡ç†å‘˜å®¡æ ¸ï¼‰
                 setTimeout(() => {
                     this.processPublishResult(publishRequest.id);
                 }, 1000);
                 
                 // å…³é—­æ¨¡æ€æ¡†
                 document.getElementById('publishResultModal').style.display = 'none';
                 
                 this.showCustomAlert('ç»“æœå‘å¸ƒè¯·æ±‚å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†...');
             }
             
             // å¤„ç†æŠ•ç¥¨å¥–åŠ±
             processVoteRewards(project, correctOptionIndex) {
                 const projectVotes = this.votes.filter(vote => vote.projectId === project.id);
                 const users = JSON.parse(localStorage.getItem('users') || '{}');
                 
                 // è®¡ç®—æ­£ç¡®å’Œé”™è¯¯æŠ•ç¥¨
                 const correctVotes = projectVotes.filter(vote => vote.selectedOption === correctOptionIndex);
                 const incorrectVotes = projectVotes.filter(vote => vote.selectedOption !== correctOptionIndex);
                 
                 // è®¡ç®—å¥–åŠ±æ± ï¼ˆé”™è¯¯æŠ•ç¥¨çš„ç§¯åˆ†ï¼‰
                 const rewardPool = incorrectVotes.reduce((total, vote) => total + vote.points, 0);
                 
                 // ç»™æ­£ç¡®æŠ•ç¥¨è€…å‘æ”¾å¥–åŠ±ï¼ˆåŒå€è¿”è¿˜ï¼‰
                 correctVotes.forEach(vote => {
                     if (users[vote.userId]) {
                         const reward = vote.points * 2; // åŒå€è¿”è¿˜
                         users[vote.userId].points += reward;
                         
                         // è®°å½•å¥–åŠ±
                         this.addPointsRecord(vote.userId, {
                             type: 'reward',
                             amount: reward,
                             description: `æŠ•ç¥¨æ­£ç¡®å¥–åŠ±ï¼š${project.title}`,
                             relatedId: project.id
                         });
                         
                         // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œæ›´æ–°æ˜¾ç¤º
                         if (this.currentUser && this.currentUser.uid === vote.userId) {
                             this.currentUser.points = users[vote.userId].points;
                             localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                             this.updateUserDisplay();
                         }
                     }
                 });
                 
                 // åˆ›å»ºè€…è·å¾—é”™è¯¯æŠ•ç¥¨çš„ç§¯åˆ†ä½œä¸ºæ”¶å…¥
                 if (users[project.creatorId] && rewardPool > 0) {
                     users[project.creatorId].points += rewardPool;
                     
                     // è®°å½•æ”¶å…¥
                     this.addPointsRecord(project.creatorId, {
                         type: 'income',
                         amount: rewardPool,
                         description: `é¡¹ç›®æ”¶å…¥ï¼š${project.title}`,
                         relatedId: project.id
                     });
                     
                     // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œæ›´æ–°æ˜¾ç¤º
                     if (this.currentUser && this.currentUser.uid === project.creatorId) {
                         this.currentUser.points = users[project.creatorId].points;
                         localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                         this.updateUserDisplay();
                     }
                 }
                 
                 localStorage.setItem('users', JSON.stringify(users));
                 
                 console.log(`å¥–åŠ±å¤„ç†å®Œæˆï¼šæ­£ç¡®æŠ•ç¥¨ ${correctVotes.length} äººï¼Œé”™è¯¯æŠ•ç¥¨ ${incorrectVotes.length} äººï¼Œå¥–åŠ±æ±  ${rewardPool} ç§¯åˆ†`);
             }
             
             // åˆ›å»ºé¡¹ç›®
             async createProject() {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const title = document.getElementById('projectTitle').value.trim();
                 const description = document.getElementById('projectDescription').value.trim();
                 const deadline = document.getElementById('deadline').value;
                 const options = Array.from(document.querySelectorAll('.option-input')).map(input => input.value.trim()).filter(option => option);
                 
                 // éªŒè¯è¾“å…¥
                 if (!title) {
                     this.showCustomAlert('è¯·è¾“å…¥é¡¹ç›®æ ‡é¢˜');
                     return;
                 }
                 
                 if (!description) {
                     this.showCustomAlert('è¯·è¾“å…¥é¡¹ç›®æè¿°');
                     return;
                 }
                 
                 if (!deadline) {
                     this.showCustomAlert('è¯·é€‰æ‹©æˆªæ­¢æ—¶é—´');
                     return;
                 }
                 
                 if (options.length < 2) {
                     this.showCustomAlert('è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹');
                     return;
                 }
                 
                 // æ£€æŸ¥æˆªæ­¢æ—¶é—´
                 const deadlineDate = new Date(deadline);
                 const now = new Date();
                 if (deadlineDate <= now) {
                     this.showCustomAlert('æˆªæ­¢æ—¶é—´å¿…é¡»åœ¨æœªæ¥');
                     return;
                 }
                 
                 try {
                     // æ„å»ºé¡¹ç›®æ•°æ®
                     const projectData = {
                         title,
                         description,
                         deadline,
                         options,
                         creatorId: this.currentUser.uid,
                         creatorName: this.currentUser.username
                     };
                     
                     // å°è¯•å‘é€åˆ°åç«¯
                     const apiUrl = `${this.apiConfig.baseURL}${this.apiConfig.endpoints.projects}`;
                     
                     try {
                         const response = await fetch(apiUrl, {
                             method: 'POST',
                             headers: {
                                 'Content-Type': 'application/json',
                                 'Authorization': `Bearer ${this.currentUser.accessToken}`
                             },
                             body: JSON.stringify(projectData)
                         });
                         
                         if (response.ok) {
                             const result = await response.json();
                             console.log('é¡¹ç›®åˆ›å»ºæˆåŠŸï¼ˆåç«¯ï¼‰:', result);
                         } else {
                             throw new Error('åç«¯åˆ›å»ºå¤±è´¥');
                         }
                     } catch (error) {
                         console.log('åç«¯åˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:', error.message);
                         // ç»§ç»­ä½¿ç”¨æœ¬åœ°å­˜å‚¨
                     }
                     
                     // æœ¬åœ°åˆ›å»ºé¡¹ç›®
                     const project = {
                         id: Date.now().toString(),
                         ...projectData,
                         status: 'active',
                         createTime: new Date().toISOString(),
                         totalVotes: 0,
                         totalPoints: 0,
                         result: null
                     };
                     
                     // æ·»åŠ åˆ°é¡¹ç›®åˆ—è¡¨
                     this.projects.push(project);
                     localStorage.setItem('projects', JSON.stringify(this.projects));
                     
                     // æ¸…ç©ºè¡¨å•
                     document.getElementById('createProjectForm').reset();
                     document.getElementById('optionsContainer').innerHTML = `
                         <div class="option-group">
                             <input type="text" class="option-input" placeholder="é€‰é¡¹1" required>
                         </div>
                         <div class="option-group">
                             <input type="text" class="option-input" placeholder="é€‰é¡¹2" required>
                         </div>
                     `;
                     
                     // é‡æ–°è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´
                     this.setDefaultDeadline();
                     
                     // é‡æ–°æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
                     await this.renderProjects();
                     
                     this.showCustomAlert('é¡¹ç›®åˆ›å»ºæˆåŠŸï¼');
                     
                 } catch (error) {
                     console.error('åˆ›å»ºé¡¹ç›®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                     this.showCustomAlert('åˆ›å»ºé¡¹ç›®å¤±è´¥ï¼Œè¯·é‡è¯•');
                 }
             }
             
             // æ¸²æŸ“æ‰€æœ‰é¡¹ç›®
             async renderAllProjects() {
                 try {
                     // å°è¯•ä»åç«¯è·å–é¡¹ç›®
                     const apiUrl = `${this.apiConfig.baseURL}${this.apiConfig.endpoints.projects}`;
                     
                     try {
                         const response = await fetch(apiUrl, {
                             headers: {
                                 'Authorization': this.currentUser ? `Bearer ${this.currentUser.accessToken}` : ''
                             }
                         });
                         
                         if (response.ok) {
                             const projects = await response.json();
                             console.log('ä»åç«¯è·å–é¡¹ç›®æˆåŠŸ:', projects.length);
                             // å¯ä»¥é€‰æ‹©åˆå¹¶åç«¯å’Œæœ¬åœ°æ•°æ®
                         }
                     } catch (error) {
                         console.log('ä»åç«¯è·å–é¡¹ç›®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:', error.message);
                     }
                     
                     const container = document.getElementById('allProjectsContainer');
                     if (!container) return;
                     
                     if (this.projects.length === 0) {
                         container.innerHTML = `
                             <div class="empty-state">
                                 <p>æš‚æ— é¡¹ç›®</p>
                                 <p>æˆä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºé¡¹ç›®çš„äººå§ï¼</p>
                             </div>
                         `;
                         return;
                     }
                     
                     // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
                     const activeProjects = this.projects.filter(p => p.status === 'active').length;
                     const totalParticipants = this.votes.length;
                     
                     // æ›´æ–°ç»Ÿè®¡
                     const statsContainer = document.querySelector('.stats-container');
                     if (statsContainer) {
                         statsContainer.innerHTML = `
                             <div class="stat-item">
                                 <span class="stat-number">${this.projects.length}</span>
                                 <span class="stat-label">æ€»é¡¹ç›®</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-number">${activeProjects}</span>
                                 <span class="stat-label">è¿›è¡Œä¸­</span>
                             </div>
                             <div class="stat-item">
                                 <span class="stat-number">${totalParticipants}</span>
                                 <span class="stat-label">æ€»å‚ä¸</span>
                             </div>
                         `;
                     }
                     
                     // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
                     container.innerHTML = this.projects.map(project => {
                         const userVote = this.currentUser ? this.votes.find(v => v.projectId === project.id && v.userId === this.currentUser.uid) : null;
                         const hasVoted = !!userVote;
                         const timeLeft = this.getTimeLeft(project.deadline);
                         const isExpired = new Date(project.deadline) < new Date();
                         
                         return `
                             <div class="project-card">
                                 <div class="project-header">
                                     <h3 class="project-title">${project.title}</h3>
                                     <span class="project-status ${project.status}">${project.status === 'active' ? 'è¿›è¡Œä¸­' : project.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²è¿‡æœŸ'}</span>
                                 </div>
                                 
                                 <div class="project-meta">
                                     <span class="participant-count">ğŸ‘¥ ${project.totalVotes || 0} äººå‚ä¸</span>
                                     <span class="time-left">${timeLeft}</span>
                                 </div>
                                 
                                 <p class="project-description">${project.description}</p>
                                 
                                 <div class="project-details">
                                     <p><strong>æˆªæ­¢æ—¶é—´ï¼š</strong>${new Date(project.deadline).toLocaleString()}</p>
                                     <p><strong>åˆ›å»ºè€…ï¼š</strong>${project.creatorName || 'æœªçŸ¥'}</p>
                                 </div>
                                 
                                 <div class="project-options">
                                     <h4>é€‰é¡¹ï¼š</h4>
                                     <ul>
                                         ${project.options.map((option, index) => `
                                             <li class="${userVote && userVote.selectedOption === index ? 'user-selected' : ''}">
                                                 ${option}
                                                 ${userVote && userVote.selectedOption === index ? ' âœ“' : ''}
                                             </li>
                                         `).join('')}
                                     </ul>
                                 </div>
                                 
                                 <div class="project-actions">
                                     ${!isExpired && project.status === 'active' && this.currentUser ? `
                                         <button class="btn btn-primary" onclick="guessGame.openVoteModal('${project.id}')">
                                             ${hasVoted ? 'é‡æ–°æŠ•ç¥¨' : 'æŠ•ç¥¨'}
                                         </button>
                                     ` : ''}
                                     
                                     ${project.result ? `
                                         <button class="btn btn-secondary" onclick="guessGame.showResults('${project.id}')">
                                             æŸ¥çœ‹ç»“æœ
                                         </button>
                                     ` : ''}
                                 </div>
                             </div>
                         `;
                     }).join('');
                     
                 } catch (error) {
                     console.error('æ¸²æŸ“é¡¹ç›®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                 }
             }
             
             // æ¸²æŸ“æˆ‘åˆ›å»ºçš„é¡¹ç›®
             async renderCreatedProjects() {
                 if (!this.currentUser) {
                     const container = document.getElementById('createdProjectsContainer');
                     if (container) {
                         container.innerHTML = '<div class="empty-state"><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„é¡¹ç›®</p></div>';
                     }
                     return;
                 }
                 
                 const userProjects = this.projects.filter(p => p.creatorId === this.currentUser.uid);
                 const container = document.getElementById('createdProjectsContainer');
                 
                 if (!container) return;
                 
                 // æ›´æ–°ç»Ÿè®¡
                 this.updateMyProjectsStats();
                 
                 if (userProjects.length === 0) {
                     container.innerHTML = `
                         <div class="empty-state">
                             <p>æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•é¡¹ç›®</p>
                             <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®å§ï¼</p>
                         </div>
                     `;
                     return;
                 }
                 
                 // æŒ‰çŠ¶æ€æ’åºï¼Œæ´»è·ƒé¡¹ç›®åœ¨å‰
                 userProjects.sort((a, b) => {
                     if (a.status === 'active' && b.status !== 'active') return -1;
                     if (a.status !== 'active' && b.status === 'active') return 1;
                     return new Date(b.createTime) - new Date(a.createTime);
                 });
                 
                 container.innerHTML = userProjects.map(project => {
                     const projectVotes = this.votes.filter(v => v.projectId === project.id);
                     const totalVotes = projectVotes.length;
                     const totalPoints = projectVotes.reduce((sum, vote) => sum + vote.points, 0);
                     const timeLeft = this.getTimeLeft(project.deadline);
                     const isExpired = new Date(project.deadline) < new Date();
                     
                     return `
                         <div class="sub-card created-project">
                             <div class="project-header">
                                 <h4 class="project-title">${project.title}</h4>
                                 <span class="project-status ${project.status}">${project.status === 'active' ? 'è¿›è¡Œä¸­' : project.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²è¿‡æœŸ'}</span>
                             </div>
                             
                             <div class="project-meta">
                                 <span class="participant-count">ğŸ‘¥ ${totalVotes} äººæŠ•ç¥¨</span>
                                 <span class="points-count">ğŸ’ ${totalPoints} ç§¯åˆ†</span>
                                 <span class="time-left">${timeLeft}</span>
                             </div>
                             
                             <p class="project-description">${project.description}</p>
                             
                             <div class="project-actions">
                                 ${!project.result && totalVotes > 0 ? `
                                     <button class="btn btn-success" onclick="guessGame.openPublishResultRequest('${project.id}')">
                                         å‘å¸ƒç»“æœ
                                     </button>
                                 ` : ''}
                                 
                                 ${project.result ? `
                                     <button class="btn btn-secondary" onclick="guessGame.showResults('${project.id}')">
                                         æŸ¥çœ‹ç»“æœ
                                     </button>
                                 ` : ''}
                                 
                                 ${totalVotes === 0 && !project.result ? `
                                     <button class="btn btn-danger" onclick="guessGame.deleteProject('${project.id}')">
                                         åˆ é™¤é¡¹ç›®
                                     </button>
                                 ` : ''}
                             </div>
                         </div>
                     `;
                 }).join('');
             }
             
             // æ¸²æŸ“æˆ‘å‚ä¸çš„é¡¹ç›®
             async renderParticipatedProjects() {
                 if (!this.currentUser) {
                     const container = document.getElementById('participatedProjectsContainer');
                     if (container) {
                         container.innerHTML = '<div class="empty-state"><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨å‚ä¸çš„é¡¹ç›®</p></div>';
                     }
                     return;
                 }
                 
                 const userVotes = this.votes.filter(v => v.userId === this.currentUser.uid);
                 const participatedProjects = userVotes.map(vote => {
                     const project = this.projects.find(p => p.id === vote.projectId);
                     return { ...project, userVote: vote };
                 }).filter(p => p.id); // è¿‡æ»¤æ‰å·²åˆ é™¤çš„é¡¹ç›®
                 
                 const container = document.getElementById('participatedProjectsContainer');
                 if (!container) return;
                 
                 if (participatedProjects.length === 0) {
                     container.innerHTML = `
                         <div class="empty-state">
                             <p>æ‚¨è¿˜æ²¡æœ‰å‚ä¸ä»»ä½•é¡¹ç›®</p>
                             <p>å»æŠ•ç¥¨é¡µé¢å‚ä¸ä¸€äº›æœ‰è¶£çš„é¡¹ç›®å§ï¼</p>
                         </div>
                     `;
                     return;
                 }
                 
                 container.innerHTML = participatedProjects.map(project => {
                     const timeLeft = this.getTimeLeft(project.deadline);
                     const isExpired = new Date(project.deadline) < new Date();
                     const selectedOption = project.options[project.userVote.selectedOption];
                     
                     return `
                         <div class="sub-card participated-project">
                             <div class="project-header">
                                 <h4 class="project-title">${project.title}</h4>
                                 <span class="project-status ${project.status}">${project.status === 'active' ? 'è¿›è¡Œä¸­' : project.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²è¿‡æœŸ'}</span>
                             </div>
                             
                             <div class="project-meta">
                                 <span class="vote-info">ğŸ’ æŠ•å…¥ ${project.userVote.points} ç§¯åˆ†</span>
                                 <span class="time-left">${timeLeft}</span>
                             </div>
                             
                             <p class="project-description">${project.description}</p>
                             
                             <div class="vote-details">
                                 <p><strong>æˆ‘çš„é€‰æ‹©ï¼š</strong>${selectedOption}</p>
                                 <p><strong>æŠ•ç¥¨æ—¶é—´ï¼š</strong>${new Date(project.userVote.timestamp).toLocaleString()}</p>
                             </div>
                             
                             <div class="project-actions">
                                 ${!isExpired && project.status === 'active' ? `
                                     <button class="btn btn-primary" onclick="guessGame.openVoteModal('${project.id}')">
                                         é‡æ–°æŠ•ç¥¨
                                     </button>
                                 ` : ''}
                                 
                                 ${project.result ? `
                                     <button class="btn btn-secondary" onclick="guessGame.showResults('${project.id}')">
                                         æŸ¥çœ‹ç»“æœ
                                     </button>
                                 ` : ''}
                                 
                                 <button class="btn btn-danger" onclick="guessGame.deleteParticipatedProject('${project.id}')">
                                     åˆ é™¤è®°å½•
                                 </button>
                             </div>
                         </div>
                     `;
                 }).join('');
             }
             
             // æ›´æ–°æˆ‘çš„é¡¹ç›®ç»Ÿè®¡
             updateMyProjectsStats() {
                 if (!this.currentUser) return;
                 
                 const createdProjects = this.projects.filter(p => p.creatorId === this.currentUser.uid);
                 const participatedProjects = this.votes.filter(v => v.userId === this.currentUser.uid);
                 
                 const createdCount = createdProjects.length;
                 const participatedCount = participatedProjects.length;
                 const totalEarned = createdProjects.reduce((sum, project) => {
                     const projectVotes = this.votes.filter(v => v.projectId === project.id);
                     return sum + projectVotes.reduce((voteSum, vote) => voteSum + vote.points, 0);
                 }, 0);
                 
                 // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                 const statsElements = {
                     created: document.querySelector('.created-count'),
                     participated: document.querySelector('.participated-count'),
                     earned: document.querySelector('.total-earned')
                 };
                 
                 if (statsElements.created) statsElements.created.textContent = createdCount;
                 if (statsElements.participated) statsElements.participated.textContent = participatedCount;
                 if (statsElements.earned) statsElements.earned.textContent = totalEarned;
             }
             
             // è®¡ç®—å‰©ä½™æ—¶é—´
             getTimeLeft(deadline) {
                 const now = new Date();
                 const end = new Date(deadline);
                 const diff = end - now;
                 
                 if (diff <= 0) {
                     return 'å·²æˆªæ­¢';
                 }
                 
                 const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                 const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                 const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                 
                 if (days > 0) {
                     return `${days}å¤©${hours}å°æ—¶`;
                 } else if (hours > 0) {
                     return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                 } else {
                     return `${minutes}åˆ†é’Ÿ`;
                 }
             }
             
             // æ‰“å¼€æŠ•ç¥¨æ¨¡æ€æ¡†
             openVoteModal(projectId) {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === projectId);
                 if (!project) {
                     this.showCustomAlert('é¡¹ç›®ä¸å­˜åœ¨');
                     return;
                 }
                 
                 // æ£€æŸ¥é¡¹ç›®çŠ¶æ€
                 if (project.status !== 'active') {
                     this.showCustomAlert('é¡¹ç›®å·²ç»“æŸï¼Œæ— æ³•æŠ•ç¥¨');
                     return;
                 }
                 
                 // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                 if (new Date(project.deadline) < new Date()) {
                     this.showCustomAlert('é¡¹ç›®å·²è¿‡æœŸï¼Œæ— æ³•æŠ•ç¥¨');
                     return;
                 }
                 
                 // è®¾ç½®å½“å‰é¡¹ç›®
                 this.selectedProjectId = projectId;
                 
                 // å¡«å……æ¨¡æ€æ¡†å†…å®¹
                 document.getElementById('voteProjectTitle').textContent = project.title;
                 document.getElementById('voteProjectDescription').textContent = project.description;
                 
                 // ç”Ÿæˆé€‰é¡¹
                 const optionsContainer = document.getElementById('voteOptions');
                 optionsContainer.innerHTML = project.options.map((option, index) => `
                     <div class="vote-option">
                         <input type="radio" id="voteOption${index}" name="voteOption" value="${index}">
                         <label for="voteOption${index}">${option}</label>
                     </div>
                 `).join('');
                 
                 // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æŠ•ç¥¨
                 const existingVote = this.votes.find(v => v.projectId === projectId && v.userId === this.currentUser.uid);
                 if (existingVote) {
                     // é¢„é€‰ç”¨æˆ·ä¹‹å‰çš„é€‰æ‹©
                     const previousOption = document.getElementById(`voteOption${existingVote.selectedOption}`);
                     if (previousOption) {
                         previousOption.checked = true;
                     }
                 }
                 
                 // æ˜¾ç¤ºæ¨¡æ€æ¡†
                 document.getElementById('voteModal').style.display = 'block';
             }
             
             // æäº¤æŠ•ç¥¨
             async submitVote() {
                 const selectedOption = document.querySelector('input[name="voteOption"]:checked');
                 const pointsInput = document.getElementById('votePoints');
                 
                 if (!selectedOption) {
                     this.showCustomAlert('è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹');
                     return;
                 }
                 
                 const points = parseInt(pointsInput.value);
                 if (!points || points < 1) {
                     this.showCustomAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡ï¼ˆè‡³å°‘1åˆ†ï¼‰');
                     return;
                 }
                 
                 if (points > this.currentUser.points) {
                     this.showCustomAlert('ç§¯åˆ†ä¸è¶³');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === this.selectedProjectId);
                 const optionIndex = parseInt(selectedOption.value);
                 const optionText = project.options[optionIndex];
                 
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦æŠ•ç¥¨å—ï¼Ÿ\n\né¡¹ç›®ï¼š${project.title}\né€‰æ‹©ï¼š${optionText}\nç§¯åˆ†ï¼š${points}`);
                 if (!confirmed) return;
                 
                 try {
                     // å°è¯•å‘é€åˆ°åç«¯
                     const voteData = {
                         projectId: this.selectedProjectId,
                         selectedOption: optionIndex,
                         points: points
                     };
                     
                     const apiUrl = `${this.apiConfig.baseURL}${this.apiConfig.endpoints.votes}`;
                     
                     try {
                         const response = await fetch(apiUrl, {
                             method: 'POST',
                             headers: {
                                 'Content-Type': 'application/json',
                                 'Authorization': `Bearer ${this.currentUser.accessToken}`
                             },
                             body: JSON.stringify(voteData)
                         });
                         
                         if (response.ok) {
                             const result = await response.json();
                             console.log('æŠ•ç¥¨æˆåŠŸï¼ˆåç«¯ï¼‰:', result);
                         } else {
                             throw new Error('åç«¯æŠ•ç¥¨å¤±è´¥');
                         }
                     } catch (error) {
                         console.log('åç«¯æŠ•ç¥¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:', error.message);
                     }
                     
                     // æ£€æŸ¥æ˜¯å¦å·²æœ‰æŠ•ç¥¨è®°å½•
                     const existingVoteIndex = this.votes.findIndex(v => v.projectId === this.selectedProjectId && v.userId === this.currentUser.uid);
                     
                     if (existingVoteIndex !== -1) {
                         // æ›´æ–°ç°æœ‰æŠ•ç¥¨
                         const oldVote = this.votes[existingVoteIndex];
                         const pointsDiff = points - oldVote.points;
                         
                         // æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¶³å¤Ÿ
                         if (pointsDiff > this.currentUser.points) {
                             this.showCustomAlert('ç§¯åˆ†ä¸è¶³ä»¥æ›´æ–°æŠ•ç¥¨');
                             return;
                         }
                         
                         // æ›´æ–°æŠ•ç¥¨è®°å½•
                         this.votes[existingVoteIndex] = {
                             ...oldVote,
                             selectedOption: optionIndex,
                             points: points,
                             timestamp: new Date().toISOString()
                         };
                         
                         // æ›´æ–°ç”¨æˆ·ç§¯åˆ†
                         this.currentUser.points -= pointsDiff;
                         
                         // è®°å½•ç§¯åˆ†å˜åŒ–
                         if (pointsDiff !== 0) {
                             this.addPointsRecord(this.currentUser.uid, {
                                 type: 'vote',
                                 amount: -pointsDiff,
                                 description: `æ›´æ–°æŠ•ç¥¨ï¼š${project.title}`,
                                 relatedId: this.selectedProjectId
                             });
                         }
                     } else {
                         // åˆ›å»ºæ–°æŠ•ç¥¨
                         const vote = {
                             id: Date.now().toString(),
                             projectId: this.selectedProjectId,
                             userId: this.currentUser.uid,
                             selectedOption: optionIndex,
                             points: points,
                             timestamp: new Date().toISOString()
                         };
                         
                         this.votes.push(vote);
                         
                         // æ‰£é™¤ç”¨æˆ·ç§¯åˆ†
                         this.currentUser.points -= points;
                         
                         // è®°å½•ç§¯åˆ†ä½¿ç”¨
                         this.addPointsRecord(this.currentUser.uid, {
                             type: 'vote',
                             amount: -points,
                             description: `æŠ•ç¥¨ï¼š${project.title}`,
                             relatedId: this.selectedProjectId
                         });
                         
                         // æ›´æ–°é¡¹ç›®ç»Ÿè®¡
                         const projectIndex = this.projects.findIndex(p => p.id === this.selectedProjectId);
                         if (projectIndex !== -1) {
                             this.projects[projectIndex].totalVotes = (this.projects[projectIndex].totalVotes || 0) + 1;
                             this.projects[projectIndex].totalPoints = (this.projects[projectIndex].totalPoints || 0) + points;
                         }
                     }
                     
                     // ä¿å­˜æ•°æ®
                     localStorage.setItem('votes', JSON.stringify(this.votes));
                     localStorage.setItem('projects', JSON.stringify(this.projects));
                     localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                     
                     // æ›´æ–°ç”¨æˆ·æ•°æ®
                     const users = JSON.parse(localStorage.getItem('users') || '{}');
                     users[this.currentUser.uid] = this.currentUser;
                     localStorage.setItem('users', JSON.stringify(users));
                     
                     // æ›´æ–°æ˜¾ç¤º
                     this.updateUserDisplay();
                     
                     // å…³é—­æ¨¡æ€æ¡†
                     document.getElementById('voteModal').style.display = 'none';
                     
                     // é‡æ–°æ¸²æŸ“é¡¹ç›®
                     await this.renderProjects();
                     
                     this.showCustomAlert('æŠ•ç¥¨æˆåŠŸï¼');
                     
                 } catch (error) {
                     console.error('æŠ•ç¥¨æ—¶å‘ç”Ÿé”™è¯¯:', error);
                     this.showCustomAlert('æŠ•ç¥¨å¤±è´¥ï¼Œè¯·é‡è¯•');
                 }
             }
             
             // æ˜¾ç¤ºé¡¹ç›®ç»“æœ
             showResults(projectId) {
                 const project = this.projects.find(p => p.id === projectId);
                 if (!project || !project.result) {
                     this.showCustomAlert('é¡¹ç›®ç»“æœå°šæœªå‘å¸ƒ');
                     return;
                 }
                 
                 const projectVotes = this.votes.filter(v => v.projectId === projectId);
                 const correctOption = project.result.correctOption;
                 const correctOptionText = project.options[correctOption];
                 
                 // ç»Ÿè®¡å„é€‰é¡¹æŠ•ç¥¨æƒ…å†µ
                 const optionStats = project.options.map((option, index) => {
                     const votes = projectVotes.filter(v => v.selectedOption === index);
                     const totalPoints = votes.reduce((sum, vote) => sum + vote.points, 0);
                     return {
                         option,
                         index,
                         votes: votes.length,
                         points: totalPoints,
                         isCorrect: index === correctOption
                     };
                 });
                 
                 // ç”¨æˆ·çš„æŠ•ç¥¨æƒ…å†µ
                 const userVote = this.currentUser ? projectVotes.find(v => v.userId === this.currentUser.uid) : null;
                 
                 let resultContent = `
                     <div class="result-header">
                         <h3>${project.title}</h3>
                         <p class="correct-answer">æ­£ç¡®ç­”æ¡ˆï¼š${correctOptionText}</p>
                     </div>
                     
                     <div class="result-stats">
                         <h4>æŠ•ç¥¨ç»Ÿè®¡ï¼š</h4>
                         ${optionStats.map(stat => `
                             <div class="option-stat ${stat.isCorrect ? 'correct' : ''}">
                                 <span class="option-text">${stat.option}</span>
                                 <span class="vote-count">${stat.votes} ç¥¨</span>
                                 <span class="points-count">${stat.points} ç§¯åˆ†</span>
                                 ${stat.isCorrect ? '<span class="correct-mark">âœ“</span>' : ''}
                             </div>
                         `).join('')}
                     </div>
                 `;
                 
                 if (userVote) {
                     const userSelectedOption = project.options[userVote.selectedOption];
                     const isUserCorrect = userVote.selectedOption === correctOption;
                     
                     resultContent += `
                         <div class="user-result">
                             <h4>æ‚¨çš„æŠ•ç¥¨ï¼š</h4>
                             <p>é€‰æ‹©ï¼š${userSelectedOption}</p>
                             <p>æŠ•å…¥ç§¯åˆ†ï¼š${userVote.points}</p>
                             <p class="result-status ${isUserCorrect ? 'correct' : 'incorrect'}">
                                 ${isUserCorrect ? 'æ­å–œæ‚¨ç­”å¯¹äº†ï¼è·å¾—åŒå€å¥–åŠ±ï¼' : 'å¾ˆé—æ†¾ï¼Œæ‚¨ç­”é”™äº†ã€‚'}
                             </p>
                         </div>
                     `;
                 }
                 
                 // å¦‚æœæ˜¯åˆ›å»ºè€…ï¼Œæ˜¾ç¤ºæ”¶ç›Šä¿¡æ¯
                 if (this.currentUser && project.creatorId === this.currentUser.uid) {
                     const incorrectVotes = projectVotes.filter(v => v.selectedOption !== correctOption);
                     const totalIncome = incorrectVotes.reduce((sum, vote) => sum + vote.points, 0);
                     
                     resultContent += `
                         <div class="creator-income">
                             <h4>åˆ›å»ºè€…æ”¶ç›Šï¼š</h4>
                             <p>æ€»æ”¶å…¥ï¼š${totalIncome} ç§¯åˆ†</p>
                             <p>æ¥æºï¼šé”™è¯¯æŠ•ç¥¨çš„ç§¯åˆ†</p>
                         </div>
                     `;
                 }
                 
                 // æ˜¾ç¤ºåœ¨è‡ªå®šä¹‰æ¨¡æ€æ¡†ä¸­
                 this.showCustomAlert(resultContent, 'é¡¹ç›®ç»“æœ');
             }
             
             // æ˜¾ç¤ºè‡ªå®šä¹‰è­¦å‘Šæ¡†
             showCustomAlert(message, title = 'æç¤º') {
                 const modal = document.getElementById('customAlert');
                 const titleElement = document.getElementById('alertTitle');
                 const messageElement = document.getElementById('alertMessage');
                 
                 titleElement.textContent = title;
                 messageElement.innerHTML = message;
                 modal.style.display = 'block';
             }
             
             // éšè—è‡ªå®šä¹‰è­¦å‘Šæ¡†
             hideCustomAlert() {
                 document.getElementById('customAlert').style.display = 'none';
             }
             
             // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤æ¡†
             showCustomConfirm(message, title = 'ç¡®è®¤') {
                 return new Promise((resolve) => {
                     const modal = document.getElementById('customConfirm');
                     const titleElement = document.getElementById('confirmTitle');
                     const messageElement = document.getElementById('confirmMessage');
                     
                     titleElement.textContent = title;
                     messageElement.textContent = message;
                     modal.style.display = 'block';
                     
                     // è®¾ç½®æŒ‰é’®äº‹ä»¶
                     const confirmBtn = document.getElementById('confirmYes');
                     const cancelBtn = document.getElementById('confirmNo');
                     
                     const handleConfirm = () => {
                         modal.style.display = 'none';
                         confirmBtn.removeEventListener('click', handleConfirm);
                         cancelBtn.removeEventListener('click', handleCancel);
                         resolve(true);
                     };
                     
                     const handleCancel = () => {
                         modal.style.display = 'none';
                         confirmBtn.removeEventListener('click', handleConfirm);
                         cancelBtn.removeEventListener('click', handleCancel);
                         resolve(false);
                     };
                     
                     confirmBtn.addEventListener('click', handleConfirm);
                     cancelBtn.addEventListener('click', handleCancel);
                 });
             }
             
             // æ˜¾ç¤ºè‡ªå®šä¹‰è¾“å…¥æ¡†
             showCustomPrompt(message, defaultValue = '', title = 'è¾“å…¥') {
                 return new Promise((resolve) => {
                     const modal = document.getElementById('customPrompt');
                     const titleElement = document.getElementById('promptTitle');
                     const messageElement = document.getElementById('promptMessage');
                     const inputElement = document.getElementById('promptInput');
                     
                     titleElement.textContent = title;
                     messageElement.textContent = message;
                     inputElement.value = defaultValue;
                     modal.style.display = 'block';
                     inputElement.focus();
                     
                     // è®¾ç½®æŒ‰é’®äº‹ä»¶
                     const confirmBtn = document.getElementById('promptOk');
                     const cancelBtn = document.getElementById('promptCancel');
                     
                     const handleConfirm = () => {
                         const value = inputElement.value.trim();
                         modal.style.display = 'none';
                         confirmBtn.removeEventListener('click', handleConfirm);
                         cancelBtn.removeEventListener('click', handleCancel);
                         inputElement.removeEventListener('keypress', handleKeypress);
                         resolve(value || null);
                     };
                     
                     const handleCancel = () => {
                         modal.style.display = 'none';
                         confirmBtn.removeEventListener('click', handleConfirm);
                         cancelBtn.removeEventListener('click', handleCancel);
                         inputElement.removeEventListener('keypress', handleKeypress);
                         resolve(null);
                     };
                     
                     const handleKeypress = (e) => {
                         if (e.key === 'Enter') {
                             handleConfirm();
                         } else if (e.key === 'Escape') {
                             handleCancel();
                         }
                     };
                     
                     confirmBtn.addEventListener('click', handleConfirm);
                     cancelBtn.addEventListener('click', handleCancel);
                     inputElement.addEventListener('keypress', handleKeypress);
                 });
             }
             
             // åˆ é™¤å•ä¸ªæŠ•ç¥¨è®°å½•
             async deleteSingleVote(voteId) {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const vote = this.votes.find(v => v.id === voteId);
                 if (!vote) {
                     this.showCustomAlert('æŠ•ç¥¨è®°å½•ä¸å­˜åœ¨');
                     return;
                 }
                 
                 if (vote.userId !== this.currentUser.uid) {
                     this.showCustomAlert('åªèƒ½åˆ é™¤è‡ªå·±çš„æŠ•ç¥¨è®°å½•');
                     return;
                 }
                 
                 const project = this.projects.find(p => p.id === vote.projectId);
                 if (project && project.status !== 'active') {
                     this.showCustomAlert('é¡¹ç›®å·²ç»“æŸï¼Œæ— æ³•åˆ é™¤æŠ•ç¥¨è®°å½•');
                     return;
                 }
                 
                 const confirmed = await this.showCustomConfirm(`ç¡®å®šè¦åˆ é™¤è¿™æ¡æŠ•ç¥¨è®°å½•å—ï¼Ÿ\n\né¡¹ç›®ï¼š${project?.title || 'æœªçŸ¥é¡¹ç›®'}\nç§¯åˆ†ï¼š${vote.points}`);
                 if (!confirmed) return;
                 
                 // åˆ é™¤æŠ•ç¥¨è®°å½•
                 this.votes = this.votes.filter(v => v.id !== voteId);
                 localStorage.setItem('votes', JSON.stringify(this.votes));
                 
                 // é€€è¿˜ç§¯åˆ†
                 this.currentUser.points += vote.points;
                 localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                 
                 // æ›´æ–°ç”¨æˆ·æ•°æ®
                 const users = JSON.parse(localStorage.getItem('users') || '{}');
                 users[this.currentUser.uid] = this.currentUser;
                 localStorage.setItem('users', JSON.stringify(users));
                 
                 // è®°å½•é€€æ¬¾
                 this.addPointsRecord(this.currentUser.uid, {
                     type: 'refund',
                     amount: vote.points,
                     description: `åˆ é™¤æŠ•ç¥¨é€€æ¬¾ï¼š${project?.title || 'æœªçŸ¥é¡¹ç›®'}`,
                     relatedId: vote.projectId
                 });
                 
                 // æ›´æ–°æ˜¾ç¤º
                 this.updateUserDisplay();
                 await this.renderProjects();
                 
                 this.showCustomAlert('æŠ•ç¥¨è®°å½•å·²åˆ é™¤ï¼Œç§¯åˆ†å·²é€€è¿˜');
             }
             
             // æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆæµ‹è¯•ç”¨ï¼‰
             async clearAllData() {
                 const confirmed = await this.showCustomConfirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼', 'å±é™©æ“ä½œ');
                 if (!confirmed) return;
                 
                 const doubleConfirmed = await this.showCustomConfirm('å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦åˆ é™¤æ‰€æœ‰é¡¹ç›®ã€æŠ•ç¥¨å’Œç”¨æˆ·æ•°æ®å—ï¼Ÿ', 'æœ€ç»ˆç¡®è®¤');
                 if (!doubleConfirmed) return;
                 
                 // æ¸…ç©ºæ‰€æœ‰æ•°æ®
                 localStorage.removeItem('projects');
                 localStorage.removeItem('votes');
                 localStorage.removeItem('users');
                 localStorage.removeItem('currentUser');
                 localStorage.removeItem('pendingResults');
                 localStorage.removeItem('withdrawalRequests');
                 localStorage.removeItem('pointsRecords');
                 
                 // é‡ç½®åº”ç”¨çŠ¶æ€
                 this.projects = [];
                 this.votes = [];
                 this.currentUser = null;
                 this.pendingResults = [];
                 this.withdrawalRequests = [];
                 
                 // æ›´æ–°æ˜¾ç¤º
                 this.updateUserDisplay();
                 await this.renderProjects();
                 
                 this.showCustomAlert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
             }
             
             // æ•°æ®è¿ç§»ï¼ˆç¡®ä¿é¡¹ç›®æœ‰æ­£ç¡®çš„optionsç»“æ„ï¼‰
             migrateData() {
                 try {
                     let needsSave = false;
                     
                     // è¿ç§»é¡¹ç›®æ•°æ®
                     this.projects.forEach(project => {
                         if (!project.options || !Array.isArray(project.options)) {
                             project.options = ['é€‰é¡¹1', 'é€‰é¡¹2']; // é»˜è®¤é€‰é¡¹
                             needsSave = true;
                         }
                         
                         if (!project.totalVotes) {
                             project.totalVotes = this.votes.filter(v => v.projectId === project.id).length;
                             needsSave = true;
                         }
                         
                         if (!project.totalPoints) {
                             const projectVotes = this.votes.filter(v => v.projectId === project.id);
                             project.totalPoints = projectVotes.reduce((sum, vote) => sum + vote.points, 0);
                             needsSave = true;
                         }
                     });
                     
                     if (needsSave) {
                         localStorage.setItem('projects', JSON.stringify(this.projects));
                         console.log('æ•°æ®è¿ç§»å®Œæˆ');
                     }
                 } catch (error) {
                     console.error('æ•°æ®è¿ç§»å¤±è´¥:', error);
                 }
             }
             
             // æ”¹è¿›çš„ç§¯åˆ†è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆAndroidå…¼å®¹ï¼‰
             openPointsDetailModal() {
                 if (!this.currentUser) {
                     this.showCustomAlert('è¯·å…ˆç™»å½•');
                     return;
                 }
                 
                 const modal = document.getElementById('pointsDetailModal');
                 
                 // Androidè®¾å¤‡ä¼˜åŒ–
                 if (/Android/i.test(navigator.userAgent)) {
                     // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
                     document.body.style.overflow = 'hidden';
                     
                     // ç¡®ä¿æ¨¡æ€æ¡†åœ¨è§†å£å†…
                     modal.style.position = 'fixed';
                     modal.style.top = '0';
                     modal.style.left = '0';
                     modal.style.width = '100%';
                     modal.style.height = '100%';
                 }
                 
                 modal.style.display = 'block';
                 
                 // æ¸²æŸ“ç§¯åˆ†è¯¦æƒ…
                 this.renderPointsDetailModal();
                 
                 // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                 setTimeout(() => {
                     modal.classList.add('show');
                 }, 10);
             }
             
             // å…³é—­ç§¯åˆ†è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆä¼˜åŒ–åŠ¨ç”»ï¼‰
             closePointsDetailModal() {
                 const modal = document.getElementById('pointsDetailModal');
                 
                 // æ·»åŠ å…³é—­åŠ¨ç”»
                 modal.classList.remove('show');
                 
                 setTimeout(() => {
                     modal.style.display = 'none';
                     
                     // æ¢å¤èƒŒæ™¯æ»šåŠ¨ï¼ˆAndroidï¼‰
                     if (/Android/i.test(navigator.userAgent)) {
                         document.body.style.overflow = '';
                     }
                 }, 300);
             }
             
             // æ·»åŠ ç§¯åˆ†è®°å½•
             addPointsRecord(userId, record) {
                 try {
                     const records = JSON.parse(localStorage.getItem('pointsRecords') || '{}');
                     
                     if (!records[userId]) {
                         records[userId] = [];
                     }
                     
                     const newRecord = {
                         id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                         timestamp: new Date().toISOString(),
                         ...record
                     };
                     
                     records[userId].push(newRecord);
                     
                     // ä¿æŒæœ€è¿‘1000æ¡è®°å½•
                     if (records[userId].length > 1000) {
                         records[userId] = records[userId].slice(-1000);
                     }
                     
                     localStorage.setItem('pointsRecords', JSON.stringify(records));
                 } catch (error) {
                     console.error('æ·»åŠ ç§¯åˆ†è®°å½•å¤±è´¥:', error);
                 }
             }
             
             // æ¸²æŸ“ç§¯åˆ†è¯¦æƒ…æ¨¡æ€æ¡†
             renderPointsDetailModal() {
                 if (!this.currentUser) return;
                 
                 const records = JSON.parse(localStorage.getItem('pointsRecords') || '{}')[this.currentUser.uid] || [];
                 const sortedRecords = records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                 
                 // è®¡ç®—æ€»æ”¶å…¥å’Œæ”¯å‡º
                 let totalIncome = 0;
                 let totalExpense = 0;
                 
                 sortedRecords.forEach(record => {
                     if (record.amount > 0) {
                         totalIncome += record.amount;
                     } else {
                         totalExpense += Math.abs(record.amount);
                     }
                 });
                 
                 // è®¡ç®—ä½™é¢
                 const calculatedBalance = totalIncome - totalExpense;
                 
                 // éªŒè¯ä½™é¢ä¸€è‡´æ€§
                 const balanceConsistent = Math.abs(calculatedBalance - this.currentUser.points) < 0.01;
                 
                 // æ›´æ–°æ‘˜è¦
                 document.getElementById('pointsSummary').innerHTML = `
                     <div class="summary-item">
                         <span class="label">å½“å‰ä½™é¢ï¼š</span>
                         <span class="value ${balanceConsistent ? '' : 'error'}">${this.currentUser.points}</span>
                     </div>
                     <div class="summary-item">
                         <span class="label">æ€»æ”¶å…¥ï¼š</span>
                         <span class="value income">+${totalIncome}</span>
                     </div>
                     <div class="summary-item">
                         <span class="label">æ€»æ”¯å‡ºï¼š</span>
                         <span class="value expense">-${totalExpense}</span>
                     </div>
                     ${!balanceConsistent ? `
                         <div class="summary-item error">
                             <span class="label">è®¡ç®—ä½™é¢ï¼š</span>
                             <span class="value">${calculatedBalance}</span>
                         </div>
                     ` : ''}
                 `;
                 
                 // æ›´æ–°è®°å½•åˆ—è¡¨
                 const recordsList = document.getElementById('pointsRecordsList');
                 if (sortedRecords.length === 0) {
                     recordsList.innerHTML = '<div class="no-records">æš‚æ— ç§¯åˆ†è®°å½•</div>';
                 } else {
                     recordsList.innerHTML = sortedRecords.map(record => {
                         const date = new Date(record.timestamp);
                         const formattedDate = date.toLocaleString('zh-CN', {
                             year: 'numeric',
                             month: '2-digit',
                             day: '2-digit',
                             hour: '2-digit',
                             minute: '2-digit'
                         });
                         
                         const amountClass = record.amount > 0 ? 'income' : 'expense';
                         const amountText = record.amount > 0 ? `+${record.amount}` : record.amount;
                         
                         return `
                             <div class="record-item">
                                 <div class="record-header">
                                     <span class="record-type">${this.getPointTypeDescription(record.type)}</span>
                                     <span class="record-amount ${amountClass}">${amountText}</span>
                                 </div>
                                 <div class="record-description">${record.description}</div>
                                 <div class="record-time">${formattedDate}</div>
                             </div>
                         `;
                     }).join('');
                 }
             }
             
             // è·å–ç§¯åˆ†ç±»å‹æè¿°
             getPointTypeDescription(type) {
                 const descriptions = {
                     'recharge': 'å……å€¼',
                     'withdraw': 'æç°',
                     'vote': 'æŠ•ç¥¨',
                     'reward': 'å¥–åŠ±',
                     'penalty': 'æƒ©ç½š',
                     'refund': 'é€€æ¬¾',
                     'income': 'æ”¶å…¥'
                 };
                 return descriptions[type] || type;
             }
         }
         
         // åˆå§‹åŒ–åº”ç”¨
         let gameApp;
         
         // ç§»åŠ¨ç«¯ä¼˜åŒ–çš„DOMåŠ è½½
         if (document.readyState === 'loading') {
             document.addEventListener('DOMContentLoaded', initApp);
         } else {
             // DOMå·²ç»åŠ è½½å®Œæˆ
             setTimeout(initApp, 0);
         }
         
         function initApp() {
             try {
                 gameApp = new GuessGamePlatform();
                 
                 // ç»‘å®šé”®ç›˜å¿«æ·é”®
                 document.addEventListener('keydown', (e) => {
                     // Ctrl+Shift+C æ¸…ç©ºæ•°æ®ï¼ˆå¼€å‘ç”¨ï¼‰
                     if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                         e.preventDefault();
                         gameApp.clearAllData();
                     }
                 });
                 
                 // å®šæœŸæ£€æŸ¥è¿‡æœŸé¡¹ç›®
                 setInterval(() => {
                     if (gameApp) {
                         gameApp.handleTimedOutProjects();
                     }
                 }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
                 
                 // å®šæœŸåˆ·æ–°æ•°æ®
                 setInterval(() => {
                     if (gameApp && gameApp.currentUser) {
                         gameApp.renderProjects();
                     }
                 }, 300000); // æ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
                 
                 console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
             } catch (error) {
                 console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
             }
         }
         
         // UIè¾…åŠ©å‡½æ•°
         function toggleCard(cardId) {
             const card = document.getElementById(cardId);
             if (card) {
                 card.classList.toggle('collapsed');
             }
         }
         
         function toggleSubCard(element) {
             const subCard = element.closest('.sub-card');
             if (subCard) {
                 subCard.classList.toggle('collapsed');
             }
         }
     </script>
 </body>
 </html>